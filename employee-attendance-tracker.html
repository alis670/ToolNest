<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HR Salary System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{background:#f8f9fa;font-family:Arial;}
.card{padding:20px;margin-bottom:20px;}
.table th,.table td{vertical-align:middle !important;}
</style>
</head>
<body class="container mt-3">

<!-- HR Login/Signup -->
<div id="loginDiv" class="card">
<h2>HR Login / Sign Up</h2>

<div class="mb-3">
<button id="showLogin" class="btn btn-primary btn-sm">Login</button>
<button id="showSignup" class="btn btn-secondary btn-sm">Sign Up</button>
</div>

<form id="loginForm" style="display:block;">
<input type="text" id="hrUserLogin" class="form-control mb-2" placeholder="Username" required>
<input type="password" id="hrPassLogin" class="form-control mb-2" placeholder="Password" required>
<button type="submit" class="btn btn-primary">Login</button>
</form>

<form id="signupForm" style="display:none;">
<input type="text" id="hrUserSignup" class="form-control mb-2" placeholder="Choose Username" required>
<input type="password" id="hrPassSignup" class="form-control mb-2" placeholder="Choose Password" required>
<button type="submit" class="btn btn-success">Sign Up</button>
</form>
</div>

<!-- Main HR Dashboard -->
<div id="mainApp" style="display:none;">
<h2 class="mb-3">HR Dashboard</h2>
<button id="logoutBtn" class="btn btn-danger mb-3">Logout</button>

<!-- Add Employee -->
<div class="card">
<h4>Add Employee</h4>
<form id="addEmployeeForm" class="mb-3">
<div class="row">
<div class="col-md-2 mb-2"><input type="text" id="empName" placeholder="Name" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="text" id="empDept" placeholder="Department" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="text" id="empDesig" placeholder="Designation" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="number" id="empSalary" placeholder="Basic Salary" class="form-control" required></div>
<div class="col-md-2 mb-2">
<select id="empCurrency" class="form-select" required>
<option value="">Select Currency</option>
<option value="PKR">PKR (₨)</option>
<option value="USD">USD ($)</option>
<option value="INR">INR (₹)</option>
<option value="EUR">EUR (€)</option>
<option value="GBP">GBP (£)</option>
</select>
</div>
</div>
<button type="submit" class="btn btn-primary">Add Employee</button>
</form>

<h4>Employee List</h4>
<table class="table table-bordered" id="employeeTable">
<tr><th>Name</th><th>Dept</th><th>Designation</th><th>Salary</th><th>Currency</th><th>Action</th></tr>
</table>
</div>

<!-- Attendance -->
<div class="card">
<h4>Mark Attendance</h4>
<form id="attendanceForm" class="mb-3">
<div class="row">
<div class="col-md-2 mb-2"><select id="attEmployee" class="form-select" required><option value="">Select Employee</option></select></div>
<div class="col-md-2 mb-2"><input type="date" id="attDate" class="form-control" required></div>
<div class="col-md-2 mb-2"><select id="attStatus" class="form-select" required>
<option value="">Select Status</option>
<option value="Present">Present</option>
<option value="Absent">Absent</option>
<option value="Late">Late</option>
</select></div>
<div class="col-md-2 mb-2"><input type="number" id="lateMinutes" placeholder="Late Minutes" class="form-control"></div>
<div class="col-md-2 mb-2"><input type="month" id="salaryMonth" class="form-control"></div>
<div class="col-md-2 mb-2"><button type="submit" class="btn btn-primary w-100">Add Attendance</button></div>
</div>
</form>

<h4>Attendance Records</h4>
<table class="table table-bordered" id="attendanceTable">
<tr><th>Date</th><th>Employee</th><th>Status</th><th>Late Minutes</th></tr>
</table>
</div>

<!-- Salary Calculation -->
<div class="card">
<h4>Calculate Salary</h4>
<form id="calculateSalaryForm" class="mb-3">
<div class="row">
<div class="col-md-2 mb-2"><select id="salaryEmployee" class="form-select" required><option value="">Select Employee</option></select></div>
<div class="col-md-2 mb-2"><input type="date" id="startDate" class="form-control" placeholder="Start Date" required></div>
<div class="col-md-2 mb-2"><input type="date" id="endDate" class="form-control" placeholder="End Date" required></div>
<div class="col-md-2 mb-2"><input type="number" step="0.1" id="overtimeHours" placeholder="Overtime Hours" class="form-control"></div>
<div class="col-md-2 mb-2"><input type="number" id="bonusAmount" placeholder="Bonus" class="form-control"></div>
<div class="col-md-2 mb-2"><button type="submit" class="btn btn-success w-100">Calculate Salary</button></div>
</div>
</form>

<h4>Salary List</h4>
<table class="table table-bordered" id="salaryTable">
<tr><th>Employee</th><th>Month</th><th>Net Salary</th><th>Payslip</th></tr>
</table>
</div>

<!-- Attendance Chart -->
<div class="card">
<h4>Attendance Chart</h4>
<canvas id="attendanceChart" height="100"></canvas>
</div>

<script>
// Toggle login/signup
document.getElementById('showLogin').onclick=()=>{document.getElementById('loginForm').style.display='block';document.getElementById('signupForm').style.display='none';};
document.getElementById('showSignup').onclick=()=>{document.getElementById('loginForm').style.display='none';document.getElementById('signupForm').style.display='block';};

// Signup
document.getElementById('signupForm').addEventListener('submit', e=>{
e.preventDefault();
const user=document.getElementById('hrUserSignup').value;
const pass=document.getElementById('hrPassSignup').value;
if(!user || !pass){alert('Enter username and password');return;}
localStorage.setItem('hrUser',user);
localStorage.setItem('hrPass',pass);
alert('HR account created! Login now.');
document.getElementById('signupForm').reset();
document.getElementById('loginForm').style.display='block';
document.getElementById('signupForm').style.display='none';
});

// Login
document.getElementById('loginForm').addEventListener('submit', e=>{
e.preventDefault();
const user=document.getElementById('hrUserLogin').value;
const pass=document.getElementById('hrPassLogin').value;
const storedUser=localStorage.getItem('hrUser');
const storedPass=localStorage.getItem('hrPass');
if(user===storedUser && pass===storedPass){
document.getElementById('loginDiv').style.display='none';
document.getElementById('mainApp').style.display='block';
}else{alert('Invalid credentials');}
});

// Logout
document.getElementById('logoutBtn').onclick=()=>{
document.getElementById('loginDiv').style.display='block';
document.getElementById('mainApp').style.display='none';
};

// --- HR Dashboard JS ---

let employees=[], attendance=[], salaries=[];
const currencySymbols={"PKR":"₨","USD":"$","INR":"₹","EUR":"€","GBP":"£"};

// Add Employee
document.getElementById('addEmployeeForm').addEventListener('submit', e=>{
e.preventDefault();
const emp={name:document.getElementById('empName').value,
dept:document.getElementById('empDept').value,
desig:document.getElementById('empDesig').value,
salary:parseFloat(document.getElementById('empSalary').value),
currency:document.getElementById('empCurrency').value};
employees.push(emp);
updateEmployeeTable(); updateEmployeeSelect();
e.target.reset();
});

// Employee Table & Select Update
function updateEmployeeTable(){
const table=document.getElementById('employeeTable');
table.innerHTML="<tr><th>Name</th><th>Dept</th><th>Designation</th><th>Salary</th><th>Currency</th><th>Action</th></tr>";
employees.forEach((e,i)=>{
const row=table.insertRow();
row.insertCell(0).innerText=e.name;
row.insertCell(1).innerText=e.dept;
row.insertCell(2).innerText=e.desig;
row.insertCell(3).innerText=e.salary.toFixed(2);
row.insertCell(4).innerText=e.currency;
const btn=document.createElement('button');btn.className='btn btn-danger btn-sm';btn.innerText='Delete';
btn.onclick=()=>{employees.splice(i,1);updateEmployeeTable();updateEmployeeSelect();};
row.insertCell(5).appendChild(btn);
});
}
function updateEmployeeSelect(){
const selects=[document.getElementById('attEmployee'),document.getElementById('salaryEmployee')];
selects.forEach(sel=>{sel.innerHTML='<option value="">Select Employee</option>';
employees.forEach((e,i)=>{const opt=document.createElement('option');opt.value=i;opt.text=e.name;sel.appendChild(opt);});});
}

// Attendance
document.getElementById('attendanceForm').addEventListener('submit', e=>{
e.preventDefault();
const empIndex=parseInt(document.getElementById('attEmployee').value);
const record={empIndex,date:document.getElementById('attDate').value,
status:document.getElementById('attStatus').value,
lateMinutes:parseInt(document.getElementById('lateMinutes').value)||0,
month:document.getElementById('salaryMonth').value};
attendance.push(record);
updateAttendanceTable(); updateAttendanceChart(); e.target.reset();
});
function updateAttendanceTable(){
const table=document.getElementById('attendanceTable');
table.innerHTML="<tr><th>Date</th><th>Employee</th><th>Status</th><th>Late Minutes</th></tr>";
attendance.forEach(a=>{const row=table.insertRow();
row.insertCell(0).innerText=a.date;
row.insertCell(1).innerText=employees[a.empIndex].name;
row.insertCell(2).innerText=a.status;
row.insertCell(3).innerText=a.lateMinutes;});
}

// Salary
document.getElementById('calculateSalaryForm').addEventListener('submit', e=>{
e.preventDefault();
const empIndex=parseInt(document.getElementById('salaryEmployee').value);
const emp=employees[empIndex];
const start=new Date(document.getElementById('startDate').value);
const end=new Date(document.getElementById('endDate').value);
const ot=parseFloat(document.getElementById('overtimeHours').value)||0;
const bonus=parseFloat(document.getElementById('bonusAmount').value)||0;
let deduction=0;
attendance.forEach(a=>{if(a.empIndex===empIndex){const d=new Date(a.date);
if(d>=start && d<=end){if(a.status==='Absent') deduction+=emp.salary/30;
if(a.status==='Late') deduction+=(emp.salary/30)*(a.lateMinutes/480);}}});
const perHour=(emp.salary/30)/8;
const otPay=ot*perHour*1.5;
const netSalary=emp.salary-deduction+otPay+bonus;
salaries.push({empIndex,month:document.getElementById('salaryMonth').value,netSalary});
updateSalaryTable();
});
function updateSalaryTable(){
const table=document.getElementById('salaryTable');
table.innerHTML="<tr><th>Employee</th><th>Month</th><th>Net Salary</th><th>Payslip</th></tr>";
salaries.forEach(s=>{
const row=table.insertRow();
row.insertCell(0).innerText=employees[s.empIndex].name;
row.insertCell(1).innerText=s.month;
row.insertCell(2).innerText=s.netSalary.toFixed(2);
const btn=document.createElement('button');btn.className='btn btn-success btn-sm';btn.innerText='Download';
btn.onclick=()=>{generatePDF(employees[s.empIndex],s.netSalary,s.month);};
row.insertCell(3).appendChild(btn);
});
}
function generatePDF(emp,net,month){
const { jsPDF } = window.jspdf;
const doc=new jsPDF();
doc.setFontSize(16);doc.text("Company Payslip",105,20,null,null,"center");
doc.setFontSize(12);doc.text(`Employee Name: ${emp.name}`,20,40);
doc.text(`Department: ${emp.dept}`,20,50);
doc.text(`Designation: ${emp.desig}`,20,60);
doc.text(`Net Salary: ${net.toFixed(2)} ${emp.currency}`,20,70);
doc.text(`Month: ${month}`,20,80);
doc.save(`${emp.name}_payslip.pdf`);
}

// Attendance Chart
const ctx=document.getElementById('attendanceChart').getContext('2d');
const chart=new Chart(ctx,{type:'bar',data:{labels:['Present','Absent','Late'],datasets:[{label:'Days',data:[0,0,0],backgroundColor:['#28a745','#dc3545','#ffc107']}]},options:{responsive:true,scales:{y:{beginAtZero:true,precision:0}}}});
function updateAttendanceChart(){const counts={Present:0,Absent:0,Late:0};attendance.forEach(a=>counts[a.status]++);chart.data.datasets[0].data=[counts.Present,counts.Absent,counts.Late];chart.update();}
</script>

</body>
</html>
