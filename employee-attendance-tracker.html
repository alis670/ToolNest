<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern HR Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { padding: 20px; transition: background-color 0.3s, color 0.3s; }
.small-muted { font-size: 0.85rem; color: #6c757d; }
.calendar-wrap { margin-top: 15px; }
.calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
.calendar-grid div { border: 1px solid #ccc; padding: 10px; text-align: center; cursor: pointer; border-radius:5px; }
.calendar-grid .present { background-color: #d4edda; }
.calendar-grid .absent { background-color: #f8d7da; }
.calendar-grid .late { background-color: #fff3cd; }
.calendar-grid .sunday-work { background-color: #cfe2ff; }
.dark-mode { background-color: #121212; color: #f1f1f1; }
.dark-mode .calendar-grid div { border-color: #444; }
</style>
</head>
<body>

<!-- Login -->
<!-- Login / Sign-Up -->
<div class="container mb-5" id="loginScreen">
    <h3 id="authTitle">HR Login</h3>
    
    <!-- Login Form -->
    <div id="loginForm">
        <div class="mb-3">
            <input type="text" id="loginUsername" class="form-control" placeholder="Username">
        </div>
        <div class="mb-3">
            <input type="password" id="loginPassword" class="form-control" placeholder="Password">
        </div>
        <div class="mb-3">
            <button class="btn btn-primary w-100" id="loginBtn">Login</button>
        </div>
        <div class="text-center">
            <a href="#" id="showSignUp">Don't have an account? Sign Up</a>
        </div>
    </div>

    <!-- Sign-Up Form -->
    <div id="signUpForm" style="display:none;">
        <div class="mb-3">
            <input type="text" id="signUpUsername" class="form-control" placeholder="Username">
        </div>
        <div class="mb-3">
            <input type="password" id="signUpPassword" class="form-control" placeholder="Password">
        </div>
        <div class="mb-3">
            <button class="btn btn-success w-100" id="signUpBtn">Sign Up</button>
        </div>
        <div class="text-center">
            <a href="#" id="showLogin">Already have an account? Login</a>
        </div>
    </div>

    <div class="mb-3">
        <button class="btn btn-outline-dark w-100" id="toggleDark">Toggle Dark Mode</button>
    </div>
</div>

<!-- Dashboard -->
<div class="container" id="dashboard" style="display:none;">

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Modern HR Dashboard</h3>
        <button class="btn btn-danger" id="logoutBtn">Logout</button>
    </div>

    <!-- Employee Management -->
    <div class="mb-4">
        <h5>Employees</h5>
        <form id="addEmployeeForm" class="row g-2 align-items-center mb-2">
            <div class="col-md-3">
                <input type="text" class="form-control" id="empName" placeholder="Name" required>
            </div>
            <div class="col-md-3">
                <input type="email" class="form-control" id="empEmail" placeholder="Email" required>
            </div>
            <div class="col-md-3">
                <input type="text" class="form-control" id="empDept" placeholder="Department">
            </div>
            <div class="col-md-3">
                <button class="btn btn-success w-100">Add Employee</button>
            </div>
        </form>
        <input type="text" class="form-control mb-2" id="searchEmployee" placeholder="Search employee">
        <div id="employeeTable"></div>
    </div>

    <!-- Attendance -->
    <div class="mb-4">
        <h5>Attendance</h5>
        <div class="row g-2 align-items-center mb-2">
            <div class="col-md-3">
                <label class="small-muted">Month</label>
                <input type="month" class="form-control" id="attendanceMonth">
            </div>
            <div class="col-md-3">
                <label class="small-muted">Select Employee</label>
                <select class="form-select" id="selectEmpForAttendance">
                    <option value="">Select Employee</option>
                </select>
            </div>
        </div>
        <div class="mb-2">
            <button class="btn btn-outline-primary me-2" id="scanEntry">Scan Entry</button>
            <button class="btn btn-outline-success" id="scanExit">Scan Exit</button>
        </div>
        <div class="calendar-wrap">
            <div id="calendar" class="calendar-grid"></div>
        </div>
    </div>

    <!-- Salary Calculation -->
    <div class="mb-4">
        <h5>Salary Calculation</h5>
        <form id="calculateSalaryForm" class="row g-2 align-items-center mb-2">
            <div class="col-6 col-md-2">
                <label class="small-muted">Employee</label>
                <select id="salaryEmployee" class="form-select" required>
                    <option value="">Select Employee</option>
                </select>
            </div>
            <div class="col-6 col-md-2">
                <label class="small-muted">Start Date</label>
                <input id="startDate" type="date" class="form-control" required>
            </div>
            <div class="col-6 col-md-2">
                <label class="small-muted">End Date</label>
                <input id="endDate" type="date" class="form-control" required>
            </div>
            <div class="col-6 col-md-2">
                <label class="small-muted">Bonus</label>
                <input id="bonusAmount" type="number" class="form-control" placeholder="Bonus">
            </div>
            <div class="col-6 col-md-2">
                <label class="small-muted">&nbsp;</label>
                <button class="btn btn-success w-100">Calculate</button>
            </div>
        </form>

        <div id="salaryBreakdownCard" class="card p-3 mb-3" style="display:none;">
            <h6>Salary Breakdown</h6>
            <div class="row">
                <div class="col-6 col-md-3"><div class="small-muted">Present days</div><strong id="presentCount">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Late days</div><strong id="lateCount">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Overtime hours</div><strong id="overtimeHours">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Sunday bonus days</div><strong id="sundayBonus">0</strong></div>
            </div>
            <hr>
            <div class="row">
                <div class="col-6 col-md-3"><div class="small-muted">Base Salary</div><strong id="baseSalary">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Late Deduction</div><strong id="lateDeduction">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Overtime Pay</div><strong id="overtimePay">0</strong></div>
                <div class="col-6 col-md-3"><div class="small-muted">Bonus</div><strong id="bonusPay">0</strong></div>
            </div>
            <div class="row mt-2">
                <div class="col-6 col-md-3"><div class="small-muted">Total Payable</div><strong id="totalPayable">0</strong></div>
                <div class="col-6 col-md-3 ms-auto text-end"><button id="exportPdfBtn" class="btn btn-outline-primary">Export Salary Slip (PDF)</button></div>
            </div>
        </div>
    </div>

    <!-- Attendance Chart -->
    <div class="mb-4">
        <h5>Attendance Chart</h5>
        <canvas id="attendanceChart" height="100"></canvas>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
let employees = [];
let attendance = {}; // { empId: { 'YYYY-MM-DD': {entry:'time', exit:'time'} } }
let darkMode = false;

// Dark mode toggle
document.getElementById('toggleDark').addEventListener('click', () => {
    darkMode = !darkMode;
    document.body.classList.toggle('dark-mode', darkMode);
});

const loginFormDiv = document.getElementById('loginForm');
const signUpFormDiv = document.getElementById('signUpForm');
const authTitle = document.getElementById('authTitle');

document.getElementById('showSignUp').addEventListener('click', e => {
    e.preventDefault();
    loginFormDiv.style.display = 'none';
    signUpFormDiv.style.display = 'block';
    authTitle.textContent = 'HR Sign-Up';
});

document.getElementById('showLogin').addEventListener('click', e => {
    e.preventDefault();
    signUpFormDiv.style.display = 'none';
    loginFormDiv.style.display = 'block';
    authTitle.textContent = 'HR Login';
});

// Simple in-memory signup & login (for demo)
let users = []; // {username, password}

document.getElementById('signUpBtn').addEventListener('click', () => {
    const username = document.getElementById('signUpUsername').value.trim();
    const password = document.getElementById('signUpPassword').value.trim();
    if(!username || !password) return alert('Enter username & password');
    if(users.find(u=>u.username===username)) return alert('Username already exists');
    users.push({username,password});
    alert('Sign-Up successful! You can now login.');
    document.getElementById('showLogin').click();
});

document.getElementById('loginBtn').addEventListener('click', () => {
    const username = document.getElementById('loginUsername').value.trim();
    const password = document.getElementById('loginPassword').value.trim();
    if(users.find(u=>u.username===username && u.password===password)){
        document.getElementById('loginScreen').style.display='none';
        document.getElementById('dashboard').style.display='block';
    } else {
        alert('Invalid username or password');
    }
});
    
// Employee Management
const addEmployeeForm = document.getElementById('addEmployeeForm');
const employeeTableDiv = document.getElementById('employeeTable');
const selectEmpForAttendance = document.getElementById('selectEmpForAttendance');
const salaryEmployee = document.getElementById('salaryEmployee');
const searchEmployeeInput = document.getElementById('searchEmployee');

addEmployeeForm.addEventListener('submit', e => {
    e.preventDefault();
    const name = document.getElementById('empName').value.trim();
    const email = document.getElementById('empEmail').value.trim();
    const dept = document.getElementById('empDept').value.trim();
    if(name && email){
        const id = Date.now();
        employees.push({id,name,email,dept});
        attendance[id] = {};
        updateEmployeeList();
        addEmployeeForm.reset();
    }
});

function updateEmployeeList(){
    const searchTerm = searchEmployeeInput.value.toLowerCase();
    employeeTableDiv.innerHTML = employees.filter(emp=>emp.name.toLowerCase().includes(searchTerm)||emp.email.toLowerCase().includes(searchTerm)).map(emp => `
        <div class="d-flex justify-content-between align-items-center border p-2 mb-1 rounded">
            <div><strong>${emp.name}</strong> (${emp.email}) - ${emp.dept || 'N/A'}</div>
            <div>
                <button class="btn btn-sm btn-info me-1" onclick="viewEmployee(${emp.id})">View</button>
                <button class="btn btn-sm btn-warning me-1" onclick="editEmployee(${emp.id})">Edit</button>
                <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${emp.id})">Delete</button>
            </div>
        </div>
    `).join('');
    selectEmpForAttendance.innerHTML = `<option value="">Select Employee</option>` + employees.map(e=>`<option value="${e.id}">${e.name}</option>`).join('');
    salaryEmployee.innerHTML = `<option value="">Select Employee</option>` + employees.map(e=>`<option value="${e.id}">${e.name}</option>`).join('');
}
searchEmployeeInput.addEventListener('input', updateEmployeeList);

function viewEmployee(id){
    const emp = employees.find(e=>e.id==id);
    alert(`Employee Info:\nName: ${emp.name}\nEmail: ${emp.email}\nDept: ${emp.dept}`);
}

function editEmployee(id){
    const emp = employees.find(e=>e.id==id);
    const newName = prompt("Edit Name", emp.name);
    const newEmail = prompt("Edit Email", emp.email);
    const newDept = prompt("Edit Dept", emp.dept);
    if(newName) emp.name=newName;
    if(newEmail) emp.email=newEmail;
    if(newDept!=null) emp.dept=newDept;
    updateEmployeeList();
}

function deleteEmployee(id){
    if(confirm("Delete this employee?")){
        employees = employees.filter(e=>e.id!=id);
        delete attendance[id];
        updateEmployeeList();
    }
}

// Attendance
const calendarDiv = document.getElementById('calendar');
const attendanceMonth = document.getElementById('attendanceMonth');

function buildCalendar(){
    const monthValue = attendanceMonth.value;
    const empId = selectEmpForAttendance.value;
    if(!monthValue || !empId) return;
    const [year,month] = monthValue.split('-').map(Number);
    const date = new Date(year, month-1, 1);
    const daysInMonth = new Date(year, month, 0).getDate();
    calendarDiv.innerHTML='';
    for(let i=1;i<=daysInMonth;i++){
        const d = new Date(year, month-1, i);
        const key = `${year}-${month}-${i}`;
        const div = document.createElement('div');
        div.textContent = i;
        const att = attendance[empId][key];
        if(att){
            if(att.entry && att.exit) div.classList.add('present');
            else if(att.entry) div.classList.add('late');
        }
        if(d.getDay()==0 && att && att.entry) div.classList.add('sunday-work');
        calendarDiv.appendChild(div);
    }
}

attendanceMonth.addEventListener('change', buildCalendar);
selectEmpForAttendance.addEventListener('change', buildCalendar);

// Scan Entry/Exit simulation
document.getElementById('scanEntry').addEventListener('click', ()=>{
    const empId = selectEmpForAttendance.value;
    const date = new Date();
    if(!empId) return alert('Select employee');
    const key = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
    attendance[empId][key] = attendance[empId][key] || {};
    attendance[empId][key].entry = date.toLocaleTimeString();
    alert(`Entry time recorded for ${employees.find(e=>e.id==empId).name}: ${attendance[empId][key].entry}`);
    buildCalendar();
});

document.getElementById('scanExit').addEventListener('click', ()=>{
    const empId = selectEmpForAttendance.value;
    const date = new Date();
    if(!empId) return alert('Select employee');
    const key = `${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}`;
    if(!attendance[empId][key] || !attendance[empId][key].entry) return alert('No entry recorded for today');
    attendance[empId][key].exit = date.toLocaleTimeString();
    alert(`Exit time recorded for ${employees.find(e=>e.id==empId).name}: ${attendance[empId][key].exit}`);
    buildCalendar();
});

// Salary Calculation
const calculateSalaryForm = document.getElementById('calculateSalaryForm');
const salaryBreakdownCard = document.getElementById('salaryBreakdownCard');

calculateSalaryForm.addEventListener('submit', e=>{
    e.preventDefault();
    const empId = salaryEmployee.value;
    const start = new Date(document.getElementById('startDate').value);
    const end = new Date(document.getElementById('endDate').value);
    const bonus = parseFloat(document.getElementById('bonusAmount').value)||0;
    if(!empId || !start || !end) return;

    let present=0, late=0, overtime=0, sundayBonus=0;
    for(let d=new Date(start);d<=end;d.setDate(d.getDate()+1)){
        const key = `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
        const att = attendance[empId][key];
        if(att && att.entry && att.exit){
            present++;
            const entryH = parseInt(att.entry.split(':')[0]);
            if(entryH>9) late++;
            const exitH = parseInt(att.exit.split(':')[0]);
            if(exitH>17) overtime++;
            if(d.getDay()==0) sundayBonus++;
        }
    }

    const baseSalary = present*1000;
    const lateDeduction = late*50;
    const overtimePay = overtime*100;
    const totalPayable = baseSalary + overtimePay + bonus + (sundayBonus*100) - lateDeduction;

    salaryBreakdownCard.style.display='block';
    document.getElementById('presentCount').textContent=present;
    document.getElementById('lateCount').textContent=late;
    document.getElementById('overtimeHours').textContent=overtime;
    document.getElementById('sundayBonus').textContent=sundayBonus;
    document.getElementById('baseSalary').textContent=baseSalary;
    document.getElementById('lateDeduction').textContent=lateDeduction;
    document.getElementById('overtimePay').textContent=overtimePay;
    document.getElementById('bonusPay').textContent=bonus;
    document.getElementById('totalPayable').textContent=totalPayable;
});

// Export PDF
document.getElementById('exportPdfBtn').addEventListener('click', ()=>{
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text('Salary Slip',20,20);
    doc.text(`Employee: ${salaryEmployee.selectedOptions[0].text}`,20,30);
    doc.text(`Present Days: ${document.getElementById('presentCount').textContent}`,20,40);
    doc.text(`Late Days: ${document.getElementById('lateCount').textContent}`,20,50);
    doc.text(`Overtime Hours: ${document.getElementById('overtimeHours').textContent}`,20,60);
    doc.text(`Sunday Bonus Days: ${document.getElementById('sundayBonus').textContent}`,20,70);
    doc.text(`Total Payable: ${document.getElementById('totalPayable').textContent}`,20,80);
    doc.save('salary-slip.pdf');
});

// Attendance Chart
const ctx = document.getElementById('attendanceChart').getContext('2d');
const attendanceChart = new Chart(ctx,{
    type:'bar',
    data:{labels:['Present','Late','Overtime','Sunday Bonus'],datasets:[{label:'Attendance',data:[0,0,0,0],backgroundColor:['green','orange','blue','purple']}]},
    options:{responsive:true,plugins:{legend:{display:false}}}
});
  
 functionupdateChart(empId){
    if(!empId) return;
    let present=0, late=0, overtime=0, sundayBonus=0;
    for(let key in attendance[empId]){
        const att = attendance[empId][key];
        if(att && att.entry && att.exit){
            present++;
            const entryH = parseInt(att.entry.split(':')[0]);
            if(entryH>9) late++;
            const exitH = parseInt(att.exit.split(':')[0]);
            if(exitH>17) overtime++;
            const dParts = key.split('-');
            const d = new Date(dParts[0], dParts[1]-1, dParts[2]);
            if(d.getDay()===0) sundayBonus++;
        }
    }
    attendanceChart.data.datasets[0].data = [present, late, overtime, sundayBonus];
    attendanceChart.update();
}

selectEmpForAttendance.addEventListener('change', () => updateChart(selectEmpForAttendance.value));
salaryEmployee.addEventListener('change', () => updateChart(salaryEmployee.value));

</script>
</body>
</html>
