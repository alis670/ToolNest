<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Employee Attendance & Salary Manager</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background:#f9f9f9; }
  h2 { margin-top: 0; }
  .container { max-width: 1200px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: center; }
  button { padding: 5px 10px; margin: 2px; cursor: pointer; }
  input, select { padding: 5px; margin: 2px; }
  .row { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 10px; }
  .col { flex: 1; min-width: 150px; }
</style>
</head>
<body>
<div class="container">
  <h2>Employee Attendance & Salary Manager</h2>

  <div class="row">
    <div class="col">
      <label>Date: <input type="date" id="attendanceDate" /></label>
    </div>
    <div class="col">
      <label>Currency: <select id="currencySelect"></select></label>
    </div>
  </div>

  <div class="row">
    <div class="col">
      <input type="text" id="empName" placeholder="Employee Name">
    </div>
    <div class="col">
      <input type="text" id="empDesignation" placeholder="Designation">
    </div>
    <div class="col">
      <input type="number" id="empSalary" placeholder="Monthly Salary">
    </div>
    <div class="col">
      <button onclick="addEmployee()">Add Employee</button>
    </div>
  </div>

  <table id="employeeTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Designation</th>
        <th>Salary</th>
        <th>Status</th>
        <th>Late Minutes</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <button onclick="calculateSalaries()">Calculate Salaries</button>
  <div id="salaryOutput"></div>
</div>

<!-- Include your currencies.js -->
<script src="currencies.js"></script>
<!-- Example currencies.js:
var currencies = [
  { code: 'USD', symbol: '$', name: 'US Dollar' },
  { code: 'PKR', symbol: 'Rs', name: 'Pakistani Rupee' },
];
-->

<script>
let employees = [];
let selectedCurrency = currencies[0];

// Populate currency dropdown
const currencySelect = document.getElementById('currencySelect');
currencies.forEach((c, idx) => {
  let opt = document.createElement('option');
  opt.value = idx;
  opt.text = `${c.symbol} - ${c.code}`;
  currencySelect.add(opt);
});
currencySelect.addEventListener('change', () => {
  selectedCurrency = currencies[currencySelect.value];
  renderEmployeeTable();
});

document.getElementById('attendanceDate').valueAsDate = new Date();

function addEmployee() {
  const name = document.getElementById('empName').value;
  const designation = document.getElementById('empDesignation').value;
  const salary = parseFloat(document.getElementById('empSalary').value);
  if (!name || !designation || !salary) { alert('Fill all fields'); return; }
  const id = Date.now();
  employees.push({ id, name, designation, salary, status: 'P', lateMinutes: 0 });
  renderEmployeeTable();
  document.getElementById('empName').value='';
  document.getElementById('empDesignation').value='';
  document.getElementById('empSalary').value='';
}

function renderEmployeeTable() {
  const tbody = document.querySelector('#employeeTable tbody');
  tbody.innerHTML = '';
  employees.forEach(emp => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${emp.name}</td>
      <td>${emp.designation}</td>
      <td>${selectedCurrency.symbol}${emp.salary.toFixed(2)}</td>
      <td>
        <select onchange="updateStatus(${emp.id}, this.value)">
          <option value="P" ${emp.status=='P'?'selected':''}>Present</option>
          <option value="A" ${emp.status=='A'?'selected':''}>Absent</option>
          <option value="L" ${emp.status=='L'?'selected':''}>Late</option>
        </select>
      </td>
      <td><input type="number" value="${emp.lateMinutes}" onchange="updateLate(${emp.id}, this.value)" /></td>
      <td><button onclick="removeEmployee(${emp.id})">Delete</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function updateStatus(id, status) {
  let emp = employees.find(e => e.id === id);
  emp.status = status;
}

function updateLate(id, value) {
  let emp = employees.find(e => e.id === id);
  emp.lateMinutes = parseInt(value) || 0;
}

function removeEmployee(id) {
  employees = employees.filter(e => e.id !== id);
  renderEmployeeTable();
}

function calculateSalaries() {
  const date = new Date(document.getElementById('attendanceDate').value);
  const totalDays = new Date(date.getFullYear(), date.getMonth()+1, 0).getDate();
  let output = '<h3>Salaries</h3><table border="1" cellpadding="5"><tr><th>Name</th><th>Salary</th><th>Present Days</th><th>Absent Days</th><th>Late Minutes</th><th>Final Salary</th></tr>';
  employees.forEach(emp => {
    let present = emp.status=='A'?0:1;
    let absent = emp.status=='A'?1:0;
    let lateDeduction = emp.lateMinutes/(totalDays*8*60) * emp.salary;
    let absentDeduction = absent * (emp.salary/totalDays);
    let finalSalary = emp.salary - absentDeduction - lateDeduction;
    output += `<tr>
      <td>${emp.name}</td>
      <td>${selectedCurrency.symbol}${emp.salary.toFixed(2)}</td>
      <td>${present}</td>
      <td>${absent}</td>
      <td>${emp.lateMinutes}</td>
      <td>${selectedCurrency.symbol}${finalSalary.toFixed(2)}</td>
    </tr>`;
  });
  output += '</table>';
  document.getElementById('salaryOutput').innerHTML = output;
  // TODO: Send data to backend via fetch/AJAX
}
</script>
</body>
</html>
