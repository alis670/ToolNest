<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Employee Attendance Calendar</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --accent:#2563eb;
  --success:#10b981; --danger:#ef4444; --radius:10px;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}
body{margin:0;padding:18px;background:var(--bg);color:#0f172a;}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.06);}
h2{margin:0 0 12px;font-size:20px;}
input,select,button{font-family:inherit;padding:8px;border-radius:8px;border:1px solid #e6eef8;}
button{cursor:pointer;font-weight:700;border:0;padding:8px 12px;}
.btn.primary{background:var(--accent);color:#fff;}
.btn.ghost{background:#f1f5f9;border:1px solid #e6eef8;}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;margin-top:12px;}
.day{background:#fbfdff;padding:12px;border-radius:6px;text-align:center;cursor:pointer;position:relative;}
.day-header{font-weight:700;background:#e2e8f0;padding:6px;border-radius:6px;text-align:center;}
.status-badge{position:absolute;bottom:4px;left:50%;transform:translateX(-50%);font-size:12px;font-weight:700;padding:2px 4px;border-radius:4px;}
.present{background:#10b981;color:#fff;}
.absent{background:#ef4444;color:#fff;}
.late{background:#f59e0b;color:#fff;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;display:none;}
.modal-content{background:#fff;padding:16px;border-radius:8px;width:300px;}
.modal-content h3{margin:0 0 12px;}
.modal-content label{display:block;margin:6px 0 2px;font-weight:600;}
.modal-content input, .modal-content select{width:100%;}
.modal-content .flex-end{display:flex;justify-content:flex-end;gap:8px;margin-top:12px;}
</style>
</head>
<body>

<div class="card">
  <h2>Employee Attendance Calendar</h2>

  <!-- Employee & Department -->
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;margin-bottom:12px;">
    <div>
      <label>Employee Name</label>
      <input type="text" id="employeeName" placeholder="John Doe">
    </div>
    <div>
      <label>Department</label>
      <input type="text" id="departmentName" placeholder="Sales">
    </div>
    <div>
      <label>Select Month</label>
      <input type="month" id="selectMonth">
    </div>
  </div>

  <!-- Calendar Headers -->
  <div class="calendar">
    <div class="day-header">Sun</div>
    <div class="day-header">Mon</div>
    <div class="day-header">Tue</div>
    <div class="day-header">Wed</div>
    <div class="day-header">Thu</div>
    <div class="day-header">Fri</div>
    <div class="day-header">Sat</div>
  </div>

  <!-- Calendar days will be injected here -->
  <div class="calendar" id="calendarDays"></div>

  <!-- Download buttons -->
  <div class="flex-end" style="margin-top:12px;">
    <button id="exportCsv" class="btn ghost">Export CSV</button>
    <button id="exportJson" class="btn ghost">Export JSON</button>
    <button id="exportPdf" class="btn ghost">Export PDF</button>
  </div>
</div>

<!-- Modal for setting attendance -->
<div class="modal" id="attendanceModal">
  <div class="modal-content">
    <h3>Mark Attendance</h3>
    <label>Status</label>
    <select id="attendanceStatus">
      <option>Present</option>
      <option>Absent</option>
      <option>Late</option>
    </select>
    <div id="lateTimeContainer" style="display:none;">
      <label>Minutes Late</label>
      <input type="number" id="lateMinutes" min="0" value="0">
    </div>
    <div class="flex-end">
      <button class="btn ghost" id="cancelModal">Cancel</button>
      <button class="btn primary" id="saveModal">Save</button>
    </div>
  </div>
</div>

<script>
let attendanceData = {}; // Key: YYYY-MM-DD, Value: {employee, department, status, lateMinutes}

// Generate calendar for selected month
function generateCalendar(){
  const monthInput = document.getElementById('selectMonth').value;
  if(!monthInput) return;
  const [year, month] = monthInput.split('-').map(Number);
  const firstDay = new Date(year, month-1, 1).getDay();
  const lastDate = new Date(year, month, 0).getDate();

  const calendar = document.getElementById('calendarDays');
  calendar.innerHTML = '';

  // Empty slots before first day
  for(let i=0;i<firstDay;i++){ const div = document.createElement('div'); calendar.appendChild(div); }

  for(let d=1;d<=lastDate;d++){
    const dateStr = `${year}-${String(month).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const div = document.createElement('div');
    div.classList.add('day');
    div.textContent = d;

    // Add status badge if exists
    if(attendanceData[dateStr]){
      const badge = document.createElement('div');
      badge.classList.add('status-badge', attendanceData[dateStr].status.toLowerCase());
      badge.textContent = attendanceData[dateStr].status + (attendanceData[dateStr].status==='Late'?` (${attendanceData[dateStr].lateMinutes}m)`:'');
      div.appendChild(badge);
    }

    div.addEventListener('click', ()=>openModal(dateStr));
    calendar.appendChild(div);
  }
}

document.getElementById('selectMonth').addEventListener('change', generateCalendar);

// Modal logic
let currentDate = '';
const modal = document.getElementById('attendanceModal');
const statusSelect = document.getElementById('attendanceStatus');
const lateContainer = document.getElementById('lateTimeContainer');

function openModal(dateStr){
  currentDate = dateStr;
  const employee = document.getElementById('employeeName').value.trim();
  const department = document.getElementById('departmentName').value.trim();
  if(!employee || !department){ alert('Enter Employee and Department'); return; }
  modal.style.display='flex';
  if(attendanceData[dateStr]){
    statusSelect.value = attendanceData[dateStr].status;
    document.getElementById('lateMinutes').value = attendanceData[dateStr].lateMinutes || 0;
  } else {
    statusSelect.value='Present';
    document.getElementById('lateMinutes').value = 0;
  }
  lateContainer.style.display = (statusSelect.value==='Late')?'block':'none';
}

statusSelect.addEventListener('change', ()=>{
  lateContainer.style.display = (statusSelect.value==='Late')?'block':'none';
});

document.getElementById('cancelModal').addEventListener('click', ()=>{
  modal.style.display='none';
});

document.getElementById('saveModal').addEventListener('click', ()=>{
  const employee = document.getElementById('employeeName').value.trim();
  const department = document.getElementById('departmentName').value.trim();
  const status = statusSelect.value;
  const lateMinutes = parseInt(document.getElementById('lateMinutes').value) || 0;
  attendanceData[currentDate] = {employee, department, status, lateMinutes};
  modal.style.display='none';
  generateCalendar();
});

// Export CSV
document.getElementById('exportCsv').addEventListener('click', ()=>{
  const rows = [['Date','Employee','Department','Status','Minutes Late']];
  for(const date in attendanceData){
    const a = attendanceData[date];
    rows.push([date,a.employee,a.department,a.status,a.lateMinutes]);
  }
  const csv = rows.map(r=>r.map(v=>`"${v}"`).join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='attendance.csv'; a.click();
  URL.revokeObjectURL(url);
});

// Export JSON
document.getElementById('exportJson').addEventListener('click', ()=>{
  const data = JSON.stringify(attendanceData,null,2);
  const blob = new Blob([data],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='attendance.json'; a.click();
  URL.revokeObjectURL(url);
});

// Export PDF
document.getElementById('exportPdf').addEventListener('click', ()=>{
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.setFontSize(12);
  doc.text("Employee Attendance Calendar", 14, 14);
  let y=22;
  for(const date in attendanceData){
    const a = attendanceData[date];
    doc.text(`${date} | ${a.employee} | ${a.department} | ${a.status} | ${a.lateMinutes} min late`, 14, y);
    y+=8;
    if(y>280){doc.addPage(); y=20;}
  }
  doc.save('attendance.pdf');
});

</script>

</body>
</html>
