<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HR Salary System</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{background:#f8f9fa;font-family:Arial;}
.card{padding:20px;margin-bottom:20px;}
.table th,.table td{vertical-align:middle !important;}
.cal-day{cursor:pointer;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;}
.modal-dialog{max-width:400px;margin:auto;}
.modal-content{padding:20px;background:#fff;border-radius:5px;}
</style>
</head>
<body class="container mt-3">

<!-- HR Login/Signup -->
<div id="loginDiv" class="card">
<h2>HR Login / Sign Up</h2>
<div class="mb-3">
<button id="showLogin" class="btn btn-primary btn-sm">Login</button>
<button id="showSignup" class="btn btn-secondary btn-sm">Sign Up</button>
</div>
<form id="loginForm" style="display:block;">
<input type="text" id="hrUserLogin" class="form-control mb-2" placeholder="Username" required>
<input type="password" id="hrPassLogin" class="form-control mb-2" placeholder="Password" required>
<button type="submit" class="btn btn-primary">Login</button>
</form>
<form id="signupForm" style="display:none;">
<input type="text" id="hrUserSignup" class="form-control mb-2" placeholder="Choose Username" required>
<input type="password" id="hrPassSignup" class="form-control mb-2" placeholder="Choose Password" required>
<button type="submit" class="btn btn-success">Sign Up</button>
</form>
</div>

<!-- Main Dashboard -->
<div id="mainApp" style="display:none;">
<h2 class="mb-3">HR Dashboard</h2>
<button id="logoutBtn" class="btn btn-danger mb-3">Logout</button>

<!-- Add Employee -->
<div class="card">
<h4>Add Employee</h4>
<form id="addEmployeeForm" class="mb-3">
<div class="row">
<div class="col-md-2 mb-2"><input type="text" id="empName" placeholder="Name" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="text" id="empDept" placeholder="Department" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="text" id="empDesig" placeholder="Designation" class="form-control" required></div>
<div class="col-md-2 mb-2"><input type="number" id="empSalary" placeholder="Basic Salary" class="form-control" required></div>
<div class="col-md-2 mb-2">
<select id="empCurrency" class="form-select" required>
<option value="">Select Currency</option>
<option value="PKR">PKR (₨)</option>
<option value="USD">USD ($)</option>
<option value="INR">INR (₹)</option>
<option value="EUR">EUR (€)</option>
<option value="GBP">GBP (£)</option>
</select>
</div>
</div>
<button type="submit" class="btn btn-primary">Add Employee</button>
</form>

<h4>Employee List</h4>
<table class="table table-bordered" id="employeeTable">
<tr><th>Name</th><th>Dept</th><th>Designation</th><th>Salary</th><th>Currency</th><th>Action</th></tr>
</table>
</div>

<!-- Attendance Calendar -->
<div class="card">
<h4>Attendance Calendar</h4>
<div class="row mb-2">
<div class="col-md-3">
<input type="month" id="attendanceMonth" class="form-control">
</div>
</div>
<div id="calendar" class="table-responsive"></div>
</div>

<!-- Attendance Table -->
<div class="card">
<h4>Attendance Records</h4>
<table class="table table-bordered" id="attendanceTable">
<tr><th>Date</th><th>Employee</th><th>Status</th><th>Late Minutes</th></tr>
</table>
</div>

<!-- Salary Calculation -->
<div class="card">
<h4>Calculate Salary</h4>
<form id="calculateSalaryForm" class="mb-3">
<div class="row">
<div class="col-md-2 mb-2"><select id="salaryEmployee" class="form-select" required><option value="">Select Employee</option></select></div>
<div class="col-md-2 mb-2"><input type="date" id="startDate" class="form-control" placeholder="Start Date" required></div>
<div class="col-md-2 mb-2"><input type="date" id="endDate" class="form-control" placeholder="End Date" required></div>
<div class="col-md-2 mb-2"><input type="number" step="0.1" id="overtimeHours" placeholder="Overtime Hours" class="form-control"></div>
<div class="col-md-2 mb-2"><input type="number" id="bonusAmount" placeholder="Bonus" class="form-control"></div>
<div class="col-md-2 mb-2"><button type="submit" class="btn btn-success w-100">Calculate Salary</button></div>
</div>
</form>

<h4>Salary List</h4>
<table class="table table-bordered" id="salaryTable">
<tr><th>Employee</th><th>Month</th><th>Net Salary</th><th>Payslip</th></tr>
</table>
</div>

<!-- Attendance Chart -->
<div class="card">
<h4>Attendance Chart</h4>
<canvas id="attendanceChart" height="100"></canvas>
</div>

<!-- Attendance Modal -->
<div class="modal" id="attendanceModal">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">Mark Attendance</h5>
<button type="button" class="btn-close" onclick="closeModal()"></button>
</div>
<div class="modal-body">
<select id="modalEmployee" class="form-select mb-2"></select>
<select id="modalStatus" class="form-select mb-2">
<option value="">Select Status</option>
<option value="Present">Present</option>
<option value="Absent">Absent</option>
<option value="Late">Late</option>
</select>
<input type="number" id="modalLateMinutes" class="form-control mb-2" placeholder="Late minutes">
<input type="hidden" id="modalDate">
<button class="btn btn-primary w-100" onclick="saveAttendance()">Save</button>
</div>
</div>
</div>
</div>

<script>
let employees=[], attendance=[], salaries=[];
const currencySymbols={"PKR":"₨","USD":"$","INR":"₹","EUR":"€","GBP":"£"};

// --- Persistent Login ---
window.onload = ()=>{
    const isLoggedIn = localStorage.getItem('isLoggedIn');
    if(isLoggedIn === 'true'){
        document.getElementById('loginDiv').style.display='none';
        document.getElementById('mainApp').style.display='block';
        loadDataFromStorage();
    }
}

// Login/Signup UI toggle
document.getElementById('showLogin').onclick=()=>{document.getElementById('loginForm').style.display='block';document.getElementById('signupForm').style.display='none';};
document.getElementById('showSignup').onclick=()=>{document.getElementById('loginForm').style.display='none';document.getElementById('signupForm').style.display='block';};

// Signup
document.getElementById('signupForm').addEventListener('submit', e=>{
e.preventDefault();
const user=document.getElementById('hrUserSignup').value;
const pass=document.getElementById('hrPassSignup').value;
if(!user||!pass){alert('Enter username/password');return;}
localStorage.setItem('hrUser',user); localStorage.setItem('hrPass',pass);
alert('Account created! Login now.');
document.getElementById('signupForm').reset(); document.getElementById('loginForm').style.display='block'; document.getElementById('signupForm').style.display='none';
});

// Login
document.getElementById('loginForm').addEventListener('submit', e=>{
e.preventDefault();
const user=document.getElementById('hrUserLogin').value;
const pass=document.getElementById('hrPassLogin').value;
const storedUser=localStorage.getItem('hrUser');
const storedPass=localStorage.getItem('hrPass');
if(user===storedUser && pass===storedPass){
    localStorage.setItem('isLoggedIn','true'); // persist login
    document.getElementById('loginDiv').style.display='none'; 
    document.getElementById('mainApp').style.display='block';
    loadDataFromStorage();
}else{alert('Invalid credentials');}
});

// Logout
document.getElementById('logoutBtn').onclick = () => {
    localStorage.removeItem('isLoggedIn');
    document.getElementById('loginDiv').style.display='block';
    document.getElementById('mainApp').style.display='none';
    saveDataToStorage();
};

// --- Storage Functions ---
function loadDataFromStorage(){
employees=JSON.parse(localStorage.getItem('employees')||"[]");
attendance=JSON.parse(localStorage.getItem('attendance')||"[]");
salaries=JSON.parse(localStorage.getItem('salaries')||"[]");
updateEmployeeTable(); updateEmployeeSelect(); updateAttendanceTable(); updateSalaryTable(); updateAttendanceChart();
}
function saveDataToStorage(){
localStorage.setItem('employees',JSON.stringify(employees));
localStorage.setItem('attendance',JSON.stringify(attendance));
localStorage.setItem('salaries',JSON.stringify(salaries));
}

// --- Employees ---
document.getElementById('addEmployeeForm').addEventListener('submit', e=>{
e.preventDefault();
const emp={name:document.getElementById('empName').value,
dept:document.getElementById('empDept').value,
desig:document.getElementById('empDesig').value,
salary:parseFloat(document.getElementById('empSalary').value),
currency:document.getElementById('empCurrency').value};
employees.push(emp); updateEmployeeTable(); updateEmployeeSelect(); saveDataToStorage(); e.target.reset();
});
function updateEmployeeTable(){
const table=document.getElementById('employeeTable');
table.innerHTML="<tr><th>Name</th><th>Dept</th><th>Designation</th><th>Salary</th><th>Currency</th><th>Action</th></tr>";
employees.forEach((e,i)=>{const row=table.insertRow();
row.insertCell(0).innerText=e.name;
row.insertCell(1).innerText=e.dept;
row.insertCell(2).innerText=e.desig;
row.insertCell(3).innerText=e.salary.toFixed(2);
row.insertCell(4).innerText=e.currency;
const btn=document.createElement('button'); btn.className='btn btn-danger btn-sm'; btn.innerText='Delete';
btn.onclick=()=>{employees.splice(i,1);updateEmployeeTable();updateEmployeeSelect(); saveDataToStorage();};
row.insertCell(5).appendChild(btn);
});
}
function updateEmployeeSelect(){
const selects=[document.getElementById('modalEmployee'),document.getElementById('salaryEmployee')];
selects.forEach(sel=>{sel.innerHTML='<option value="">Select Employee</option>';
employees.forEach((e,i)=>{const opt=document.createElement('option');opt.value=i;opt.text=e.name;sel.appendChild(opt);});});
}

// --- Attendance Calendar ---
function generateCalendar(monthValue){
const [year,month]=monthValue.split('-').map(Number);
const firstDay=new Date(year,month-1,1);
const lastDay=new Date(year,month,0);
let html='<table class="table table-bordered text-center"><tr>';
const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
dayNames.forEach(d=>html+='<th>'+d+'</th>'); html+='</tr><tr>';
let dayCounter=1;
for(let i=0;i<firstDay.getDay();i++) html+='<td></td>';
for(let i=firstDay.getDay();i<7;i++){html+='<td class="cal-day" data-date="'+year+'-'+String(month).padStart(2,'0')+'-'+String(dayCounter).padStart(2,'0')+'">'+dayCounter+'</td>'; dayCounter++;}
html+='</tr>';
while(dayCounter<=lastDay.getDate()){
html+='<tr>';
for(let i=0;i<7;i++){
if(dayCounter>lastDay.getDate()){html+='<td></td>';}else{
html+='<td class="cal-day" data-date="'+year+'-'+String(month).padStart(2,'0')+'-'+String(dayCounter).padStart(2,'0')+'">'+dayCounter+'</td>';
dayCounter++;
}
}
html+='</tr>';
}
html+='</table>';
document.getElementById('calendar').innerHTML=html;
document.querySelectorAll('.cal-day').forEach(td=>td.onclick=openModal);
updateCalendarColors(monthValue);
}
function updateCalendarColors(monthValue){
document.querySelectorAll('.cal-day').forEach(td=>{
const date=td.getAttribute('data-date');
const record=attendance.find(a=>a.date===date);
if(record){
if(record.status==='Present') td.style.background='#28a745'; 
else if(record.status==='Absent') td.style.background='#dc3545'; 
else if(record.status==='Late') td.style.background='#ffc107';
td.style.color='#fff';
}else{td.style.background=''; td.style.color='';}
});
}
function openModal(e){
const date=e.currentTarget.getAttribute('data-date');
document.getElementById('modalDate').value=date;
const empSelect=document.getElementById('modalEmployee');
empSelect.innerHTML='<option value="">Select Employee</option>';
employees.forEach((emp,i)=>{const opt=document.createElement('option');opt.value=i;opt.text=emp.name;empSelect.appendChild(opt);});
document.getElementById('modalStatus').value='';
document.getElementById('modalLateMinutes').value='';
document.getElementById('attendanceModal').style.display='flex';
}
function closeModal(){document.getElementById('attendanceModal').style.display='none';}
function saveAttendance(){
const empIndex=parseInt(document.getElementById('modalEmployee').value);
const status=document.getElementById('modalStatus').value;
const lateMinutes=parseInt(document.getElementById('modalLateMinutes').value)||0;
const date=document.getElementById('modalDate').value;
if(isNaN(empIndex) || !status){alert('Select employee and status'); return;}
const existingIndex=attendance.findIndex(a=>a.date===date && a.empIndex===empIndex);
if(existingIndex>-1) attendance[existingIndex]={empIndex,date,status,lateMinutes,month:date.slice(0,7)};
else attendance.push({empIndex,date,status,lateMinutes,month:date.slice(0,7)});
saveDataToStorage();
updateCalendarColors(date.slice(0,7));
updateAttendanceTable();
closeModal();
}
document.getElementById('attendanceMonth').addEventListener('change', e=>{
if(e.target.value) generateCalendar(e.target.value);
});
const now=new Date();
document.getElementById('attendanceMonth').value=now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0');
generateCalendar(document.getElementById('attendanceMonth').value);

// --- Attendance Table ---
function updateAttendanceTable(){
const table=document.getElementById('attendanceTable');
table.innerHTML="<tr><th>Date</th><th>Employee</th><th>Status</th><th>Late Minutes</th></tr>";
attendance.forEach(a=>{const row=table.insertRow();
row.insertCell(0).innerText=a.date;
row.insertCell(1).innerText=employees[a.empIndex].name;
row.insertCell(2).innerText=a.status;
row.insertCell(3).innerText=a.lateMinutes;});
}

// --- Salary Calculation ---
document.getElementById('calculateSalaryForm').addEventListener('submit', e=>{
e.preventDefault();
const empIndex=parseInt(document.getElementById('salaryEmployee').value);
const emp=employees[empIndex];
const start=new Date(document.getElementById('startDate').value);
const end=new Date(document.getElementById('endDate').value);
const ot=parseFloat(document.getElementById('overtimeHours').value)||0;
const bonus=parseFloat(document.getElementById('bonusAmount').value)||0;
let deduction=0;
attendance.forEach(a=>{if(a.empIndex===empIndex){const d=new Date(a.date);
if(d>=start && d<=end){if(a.status==='Absent') deduction+=emp.salary/30;
if(a.status==='Late') deduction+=(emp.salary/30)*(a.lateMinutes/480);}}});
const perHour=(emp.salary/30)/8;
const otPay=ot*perHour*1.5;
const netSalary=emp.salary-deduction+otPay+bonus;
salaries.push({empIndex,month:document.getElementById('attendanceMonth').value,netSalary}); updateSalaryTable(); saveDataToStorage();
});
function updateSalaryTable(){
const table=document.getElementById('salaryTable');
table.innerHTML="<tr><th>Employee</th><th>Month</th><th>Net Salary</th><th>Payslip</th></tr>";
salaries.forEach(s=>{
const row=table.insert
