<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium HR Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg:#fff; --text:#000; --card-bg:#f8f9fa; --input-bg:#fff; --input-text:#000; --table-header:#e9ecef;
  --present:#28a745; --absent:#dc3545; --late:#ffc107;
}
body.dark-mode { 
  --bg:#121212; --text:#f5f5f5; --card-bg:#1e1e1e; --input-bg:#2a2a2a; --input-text:#f5f5f5; --table-header:#333; 
  --present:#28a745; --absent:#dc3545; --late:#ffc107;
}
body { background:var(--bg); color:var(--text); }
.card { background:var(--card-bg); color:var(--text); margin-bottom:1rem; }
input, select { background:var(--input-bg); color:var(--input-text); }
table th { background:var(--table-header); color:var(--text); }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:var(--card-bg); padding:1rem; border-radius:5px; width:100%; max-width:400px; }
.btn-close { float:right; cursor:pointer; background:none; border:none; font-size:1.2rem; }
.employee-row { display:flex; flex-wrap:wrap; gap:0.5rem; border-bottom:1px solid #dee2e6; padding:0.5rem 0; align-items:center; }
.employee-row > div { flex:1 1 120px; min-width:80px; }
.employee-row button { flex:0 0 auto; }
@media (max-width:576px){ .employee-row > div { flex:1 1 100%; } }
.day-cell { cursor:pointer; text-align:center; padding:5px; border:1px solid #ccc; width:30px; display:inline-block; margin:1px; border-radius:4px; }
</style>
</head>
<body class="container mt-4">

<!-- LOGIN / SIGNUP -->
<div id="loginDiv" class="card p-4">
<h2>HR Login / Sign Up</h2>
<div class="mb-3">
<button id="showLogin" class="btn btn-primary btn-sm">Login</button>
<button id="showSignup" class="btn btn-secondary btn-sm">Sign Up</button>
<button id="toggleTheme" class="btn btn-dark btn-sm float-end">Toggle Dark Mode</button>
</div>
<form id="loginForm" style="display:block;">
<input type="text" id="hrUserLogin" class="form-control mb-2" placeholder="Username" required>
<input type="password" id="hrPassLogin" class="form-control mb-2" placeholder="Password" required>
<button type="submit" class="btn btn-primary">Login</button>
</form>
<form id="signupForm" style="display:none;">
<input type="text" id="hrUserSignup" class="form-control mb-2" placeholder="Choose Username" required>
<input type="password" id="hrPassSignup" class="form-control mb-2" placeholder="Choose Password" required>
<button type="submit" class="btn btn-success">Sign Up</button>
</form>
</div>

<!-- DASHBOARD -->
<div id="mainApp" style="display:none;">
<h2>HR Dashboard</h2>
<button id="logoutBtn" class="btn btn-danger mb-3">Logout</button>

<!-- Employee -->
<div class="card">
<h4>Add Employee</h4>
<form id="addEmployeeForm" class="row g-2 mb-3">
<div class="col-md-2"><input type="text" id="empName" placeholder="Name" class="form-control" required></div>
<div class="col-md-2"><input type="text" id="empDept" placeholder="Department" class="form-control" required></div>
<div class="col-md-2"><input type="text" id="empDesig" placeholder="Designation" class="form-control" required></div>
<div class="col-md-2"><input type="number" id="empSalary" placeholder="Salary" class="form-control" required></div>
<div class="col-md-2"><select id="empCurrency" class="form-select" required></select></div>
<div class="col-md-2"><button type="submit" class="btn btn-primary w-100">Add</button></div>
</form>
<h4>Employee List</h4>
<div id="employeeTable"></div>
</div>

<!-- Attendance -->
<div class="card">
<h4>Attendance Calendar</h4>
<div class="row mb-2"><div class="col-md-3"><input type="month" id="attendanceMonth" class="form-control"></div></div>
<div id="calendar"></div>
</div>

<div class="card">
<h4>Attendance Records</h4>
<table class="table table-bordered" id="attendanceTable"><tr><th>Date</th><th>Employee</th><th>Status</th><th>Late</th><th>Action</th></tr></table>
</div>

<!-- Salary -->
<div class="card">
<h4>Calculate Salary</h4>
<form id="calculateSalaryForm" class="row g-2 mb-3">
<div class="col-md-2"><select id="salaryEmployee" class="form-select" required><option value="">Select Employee</option></select></div>
<div class="col-md-2"><input type="date" id="startDate" class="form-control" required></div>
<div class="col-md-2"><input type="date" id="endDate" class="form-control" required></div>
<div class="col-md-2"><input type="number" step="0.1" id="overtimeHours" placeholder="Overtime" class="form-control"></div>
<div class="col-md-2"><input type="number" id="bonusAmount" placeholder="Bonus" class="form-control"></div>
<div class="col-md-2"><button type="submit" class="btn btn-success w-100">Calculate</button></div>
</form>
<h4>Salary List</h4>
<table class="table table-bordered" id="salaryTable"><tr><th>Employee</th><th>Month</th><th>Net Salary</th><th>Action</th></tr></table>
</div>

<!-- Chart -->
<div class="card"><h4>Attendance Chart</h4><canvas id="attendanceChart" height="100"></canvas></div>

<!-- Attendance Modal -->
<div class="modal" id="attendanceModal">
<div class="modal-content">
<h5>Mark Attendance <button class="btn-close" onclick="closeModal()">&times;</button></h5>
<select id="modalEmployee" class="form-select mb-2"></select>
<select id="modalStatus" class="form-select mb-2">
<option value="">Select Status</option>
<option value="Present">Present</option>
<option value="Absent">Absent</option>
<option value="Late">Late</option>
</select>
<input type="number" id="modalLateMinutes" class="form-control mb-2" placeholder="Late minutes">
<input type="hidden" id="modalDate">
<button class="btn btn-primary w-100" onclick="saveAttendance()">Save</button>
</div>
</div>

<script src="loadcurrencies.js"></script>
<script>
let employees=[], attendance=[], salaries=[], chartInstance=null;

// Save/load
function saveData(){localStorage.setItem('employees',JSON.stringify(employees));localStorage.setItem('attendance',JSON.stringify(attendance));localStorage.setItem('salaries',JSON.stringify(salaries));}
function loadData(){employees=JSON.parse(localStorage.getItem('employees')||"[]");attendance=JSON.parse(localStorage.getItem('attendance')||"[]");salaries=JSON.parse(localStorage.getItem('salaries')||"[]");updateEmployeeTable();updateEmployeeSelect();renderAttendanceTable();renderCalendar();renderChart();}

// Employee table
function updateEmployeeTable(){const table=document.getElementById('employeeTable');table.innerHTML='';employees.forEach((e,i)=>{const row=document.createElement('div');row.className='employee-row';row.innerHTML=`<div>${e.name}</div><div>${e.dept}</div><div>${e.desig}</div><div>${e.salary.toFixed(2)}</div><div>${e.currency}</div>`;const btn=document.createElement('button');btn.className='btn btn-danger btn-sm';btn.innerText='Delete';btn.onclick=()=>{employees.splice(i,1);saveData();updateEmployeeTable();updateEmployeeSelect();renderAttendanceTable();renderChart();};row.appendChild(btn);table.appendChild(row);});}
function updateEmployeeSelect(){[document.getElementById('modalEmployee'),document.getElementById('salaryEmployee')].forEach(sel=>{sel.innerHTML='<option value="">Select Employee</option>';employees.forEach((e,i)=>{const opt=document.createElement('option');opt.value=i;opt.text=e.name;sel.appendChild(opt);});});}

// Attendance modal
function openModal(date){document.getElementById('modalDate').value=date;document.getElementById('attendanceModal').style.display='flex';}
function closeModal(){document.getElementById('attendanceModal').style.display='none';}
function saveAttendance(){
  const empIndex=parseInt(document.getElementById('modalEmployee').value);
  const status=document.getElementById('modalStatus').value;
  const late=parseInt(document.getElementById('modalLateMinutes').value)||0;
  const date=document.getElementById('modalDate').value;
  if(isNaN(empIndex)||!status){alert("Select employee/status");return;}
  attendance.push({date,empIndex,status,late});saveData();renderAttendanceTable();renderCalendar();renderChart();closeModal();
}

// Attendance table
function renderAttendanceTable(){const table=document.getElementById('attendanceTable');table.innerHTML="<tr><th>Date</th><th>Employee</th><th>Status</th><th>Late</th><th>Action</th></tr>";attendance.forEach((a,i)=>{const row=table.insertRow();row.insertCell(0).innerText=a.date;row.insertCell(1).innerText=employees[a.empIndex]?.name||"";row.insertCell(2).innerText=a.status;row.insertCell(3).innerText=a.late;const btn=document.createElement('button');btn.className='btn btn-sm btn-danger';btn.innerText='Delete';btn.onclick=()=>{attendance.splice(i,1);saveData();renderAttendanceTable();renderCalendar();renderChart();};row.insertCell(4).appendChild(btn);});}

// Calendar with colors
function renderCalendar(){
  const div=document.getElementById('calendar');const month=document.getElementById('attendanceMonth').value; if(!month){div.innerHTML='';return;}
  const [y,m]=month.split('-');const days=new Date(y,m,0).getDate();
  let html='<div>';
  for(let d=1;d<=days;d++){
    const dayStr=`${y}-${m.padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
    let att=attendance.find(a=>a.date===dayStr); let color=''; if(att){color=att.status==='Present'?getComputedStyle(document.body).getPropertyValue('--present'):att.status==='Absent'?getComputedStyle(document.body).getPropertyValue('--absent'):getComputedStyle(document.body).getPropertyValue('--late');}
    html+=`<div class="day-cell" style="background:${color};" onclick="openModal('${dayStr}')">${d}</div>`;
  }
  html+='</div>';div.innerHTML=html;
}

// Chart
function renderChart(){const ctx=document.getElementById('attendanceChart');let present=0,absent=0,late=0;attendance.forEach(a=>{if(a.status==='Present') present++; else if(a.status==='Absent') absent++; else late++;});if(chartInstance) chartInstance.destroy();chartInstance=new Chart(ctx,{type:'pie',data:{labels:['Present','Absent','Late'],datasets:[{data:[present,absent,late],backgroundColor:[getComputedStyle(document.body).getPropertyValue('--present'),getComputedStyle(document.body).getPropertyValue('--absent'),getComputedStyle(document.body).getPropertyValue('--late')] }]}});}

// Dashboard logic
document.addEventListener('DOMContentLoaded',()=>{
const loginDiv=document.getElementById('loginDiv');const loginForm=document.getElementById('loginForm');const signupForm=document.getElementById('signupForm');const mainApp=document.getElementById('mainApp');const logoutBtn=document.getElementById('logoutBtn');const showLoginBtn=document.getElementById('showLogin');const showSignupBtn=document.getElementById('showSignup');const toggleThemeBtn=document.getElementById('toggleTheme');

showLoginBtn.addEventListener('click',()=>{loginForm.style.display='block';signupForm.style.display='none';});
showSignupBtn.addEventListener('click',()=>{loginForm.style.display='none';signupForm.style.display='block';});
toggleThemeBtn.addEventListener('click',()=>{document.body.classList.toggle('dark-mode');renderCalendar();renderChart();});

if(localStorage.getItem('isLoggedIn')==='true'){loginDiv.style.display='none';mainApp.style.display='block';loadData();}

// Load currencies
populateCurrencyDropdown('empCurrency');

signupForm.addEventListener('submit',e=>{e.preventDefault();const user=document.getElementById('hrUserSignup').value.trim();const pass=document.getElementById('hrPassSignup').value.trim();if(!user||!pass){alert('Enter username/password');return;}localStorage.setItem('hrUser',user);localStorage.setItem('hrPass',pass);alert('Account created! Login.');signupForm.reset();loginForm.style.display='block';signupForm.style.display='none';});

loginForm.addEventListener('submit',e=>{e.preventDefault();const user=document.getElementById('hrUserLogin').value.trim();const pass=document.getElementById('hrPassLogin').value.trim();const storedUser=localStorage.getItem('hrUser');const storedPass=localStorage.getItem('hrPass');if(user===storedUser && pass===storedPass){localStorage.setItem('isLoggedIn','true');loginDiv.style.display='none';mainApp.style.display='block';loadData();}else{alert('Invalid credentials!');}});

logoutBtn.addEventListener('click',()=>{localStorage.removeItem('isLoggedIn');loginDiv.style.display='block';mainApp.style.display='none';});

document.getElementById('addEmployeeForm').addEventListener('submit',e=>{e.preventDefault();const emp={name:document.getElementById('empName').value,dept:document.getElementById('empDept').value,desig:document.getElementById('empDesig').value,salary:parseFloat(document.getElementById('empSalary').value),currency:document.getElementById('empCurrency').value};employees.push(emp);saveData();updateEmployeeTable();updateEmployeeSelect();e.target.reset();});
document.getElementById('attendanceMonth').addEventListener('change',renderCalendar);
});
</script>
</body>
</html>
