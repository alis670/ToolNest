<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tax / GST / VAT Calculator</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, select { padding: 8px; margin: 5px 0; width: 200px; }
button { padding: 8px 16px; margin: 10px 5px 0 0; cursor: pointer; }
.results { margin-top: 20px; }
.circle-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    margin-top: 10px;
    display: inline-block;
}
.roi-ring { transform: rotate(-90deg); }
.circle-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}
</style>
</head>
<body>

<h1>Tax / GST / VAT Calculator</h1>

<div>
    <label>Amount:</label>
    <input type="number" id="amount" placeholder="1000">
    <select id="currencyAmount"></select>
</div>

<div>
    <label>Tax Rate (%):</label>
    <input type="number" id="taxRate" placeholder="18">
</div>

<div>
    <label>Calculation Type:</label>
    <select id="calcType">
        <option value="add">Add Tax (Net → Gross)</option>
        <option value="remove">Remove Tax (Gross → Net)</option>
    </select>
</div>

<div>
    <button onclick="calculateTax()">Calculate</button>
    <button onclick="clearFields()">Clear</button>
    <button onclick="downloadResults()">Download Results</button>
</div>

<div class="results">
    <div>Tax Amount: <span id="taxAmount">0</span></div>
    <div>Net Amount: <span id="netAmount">0</span></div>
    <div>Gross Amount: <span id="grossAmount">0</span></div>

    <div class="circle-wrapper">
        <svg class="roi-ring" width="120" height="120">
            <circle class="bg" cx="60" cy="60" r="50" stroke="#eee" stroke-width="10" fill="none" />
            <circle class="progressTax" cx="60" cy="60" r="50" stroke="orange" stroke-width="10" fill="none"
                    stroke-linecap="round" stroke-dasharray="314" stroke-dashoffset="314" />
        </svg>
        <div class="circle-text" id="taxCircle">0%</div>
        <div style="text-align:center;">Tax %</div>
    </div>
</div>

<!-- Back to Dashboard button -->
<div style="margin-top:20px;">
    <button onclick="goToDashboard()" style="padding:8px 16px; cursor:pointer;">⬅ Back to Dashboard</button>
</div>

<script src="loadCurrencies.js"></script>
<script>
populateCurrencyDropdown('currencyAmount');

function calculateTax() {
    let amount = parseFloat(document.getElementById('amount').value);
    let rate = parseFloat(document.getElementById('taxRate').value);
    let type = document.getElementById('calcType').value;

    if(isNaN(amount) || isNaN(rate)) {
        alert("Please enter valid Amount and Tax Rate.");
        return;
    }

    let taxAmount = 0, net = 0, gross = 0;

    if(type === "add") {
        taxAmount = (amount * rate) / 100;
        gross = amount + taxAmount;
        net = amount;
    } else {
        net = amount / (1 + rate / 100);
        taxAmount = amount - net;
        gross = amount;
    }

    document.getElementById('taxAmount').innerText = taxAmount.toFixed(2);
    document.getElementById('netAmount').innerText = net.toFixed(2);
    document.getElementById('grossAmount').innerText = gross.toFixed(2);

    // Update Tax % Circle
    const circle = document.querySelector('.progressTax');
    const offset = 314 - (Math.min(rate, 100)/100)*314;
    circle.style.strokeDashoffset = offset;
    document.getElementById('taxCircle').innerText = rate.toFixed(2) + "%";
}

function clearFields() {
    document.getElementById('amount').value = '';
    document.getElementById('taxRate').value = '';
    document.getElementById('taxAmount').innerText = '0';
    document.getElementById('netAmount').innerText = '0';
    document.getElementById('grossAmount').innerText = '0';
    document.querySelector('.progressTax').style.strokeDashoffset = 314;
    document.getElementById('taxCircle').innerText = '0%';
}

function downloadResults() {
    const amount = document.getElementById('amount').value;
    const rate = document.getElementById('taxRate').value;
    const taxAmount = document.getElementById('taxAmount').innerText;
    const net = document.getElementById('netAmount').innerText;
    const gross = document.getElementById('grossAmount').innerText;
    const currency = document.getElementById('currencyAmount').value;

    const csvContent = `Amount,${amount},${currency}\nTax Rate,${rate}%\nTax Amount,${taxAmount}\nNet Amount,${net}\nGross Amount,${gross}`;
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'Tax_Calculator_Results.csv';
    a.click();
    URL.revokeObjectURL(url);
}

function goToDashboard() {
    window.location.href = "index.html";
}
</script>
</body>
</html>
