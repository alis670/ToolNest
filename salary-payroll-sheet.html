      <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Salary Payroll Sheet — Advanced</title>
<style>
:root{
  --bg:#f6f8fb; --card:#fff; --muted:#6b7280; --accent:#2563eb;
  --success:#10b981; --danger:#ef4444; --radius:10px;
  font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:#0f172a;padding:18px;}
.app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1fr 360px;gap:16px;align-items:start;}
.card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(2,6,23,0.06);}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;margin-bottom:12px;}
h1{font-size:18px;margin-bottom:4px;}
small.muted{color:var(--muted);}
input,select,button{font-family:inherit;}
input,select{padding:8px;border-radius:8px;border:1px solid #e6eef8;background:#fff;width:100%;}
button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;}
.btn{font-weight:700;}
.primary{background:var(--accent);color:#fff;}
.ghost{background:#f1f5f9;border:1px solid #e6eef8;}
.danger{background:var(--danger);color:#fff;}
.flex-end{display:flex;align-items:end;gap:8px;flex-wrap:wrap;}
.table{margin-top:12px;overflow:auto;border-radius:8px;border:1px solid #eef2ff;}
table{width:100%;border-collapse:collapse;font-size:14px;}
th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left;}
th{background:#fbfdff;position:sticky;top:0;}
.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px;}
.kpi{background:#fbfdff;padding:12px;border-radius:8px;text-align:center;}
.kpi h3{margin:0;font-size:13px;}
.kpi p{margin:6px 0 0;font-weight:800;}
.filter-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;}
.audit{margin-top:12px;max-height:180px;overflow:auto;font-size:13px;color:var(--muted);}
@media (max-width:1000px){ .app{grid-template-columns:1fr} .kpis{grid-template-columns:repeat(2,1fr)} }
label{display:block;margin-bottom:6px;font-weight:600;}
</style>
</head>
<body>
<div class="app">
  <!-- MAIN -->
  <div class="card">
    <div class="header">
      <div>
        <h1>Salary Payroll Sheet</h1>
        <small class="muted">Add and manage employee salaries</small>
      </div>
    </div>

    <!-- Form -->
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:8px;align-items:end;">
      <div><label>Name</label><input id="empName" placeholder="Employee Name"></div>
      <div><label>Base Salary</label><input id="baseSalary" type="number" min="0" step="0.01"></div>
      <div><label>Bonus</label><input id="bonus" type="number" min="0" step="0.01"></div>
      <div><label>Deductions</label><input id="deductions" type="number" min="0" step="0.01"></div>
      <div style="display:flex;align-items:end;gap:8px;">
        <button id="addEmp" class="btn primary">Add</button>
        <button id="clearEmp" class="btn ghost">Clear</button>
      </div>
    </div>

    <!-- Filters -->
    <div class="filter-row">
      <div style="min-width:140px;"><label>Search Name</label><input id="searchEmp" placeholder="Search"></div>
      <div style="display:flex;align-items:end;gap:8px;">
        <button id="applyFilter" class="btn ghost">Apply</button>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;flex-wrap:wrap;">
        <button id="exportCsv" class="btn ghost">Export CSV</button>
        <button id="exportJson" class="btn ghost">Export JSON</button>
        <button id="importBtn" class="btn ghost">Import JSON</button>
        <input id="importFile" type="file" accept=".json" style="display:none;">
      </div>
    </div>

    <!-- KPIs -->
    <div class="kpis">
      <div class="kpi"><h3>Total Payroll</h3><p id="totalPayroll">0</p></div>
      <div class="kpi"><h3>Average Salary</h3><p id="avgSalary">0</p></div>
      <div class="kpi"><h3>Highest Salary</h3><p id="highestSalary">0</p></div>
    </div>

    <!-- Table -->
    <div class="table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Base Salary</th>
            <th>Bonus</th>
            <th>Deductions</th>
            <th>Net Salary</th>
            <th style="text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="empTableBody"></tbody>
      </table>
    </div>

    <div style="margin-top:12px;text-align:right;">
      <button onclick="goToDashboard()" class="btn ghost">⬅ Back to Dashboard</button>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="card" style="display:flex;flex-direction:column;gap:12px;">
    <h3 style="margin:0 0 8px">Recent Audit</h3>
    <div id="auditLog" class="audit"></div>
  </div>
</div>

<script>
let employees = [];
function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }

function fmt(n){ return Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
function saveAll(){ localStorage.setItem('payroll_employees', JSON.stringify(employees)); renderTable(); renderKPIs(); }

function loadAll(){ employees = JSON.parse(localStorage.getItem('payroll_employees')||'[]'); renderTable(); renderKPIs(); }

function calculateNet(emp){ return (Number(emp.base)||0) + (Number(emp.bonus)||0) - (Number(emp.deductions)||0); }

function renderTable(){
  const tbody = document.getElementById('empTableBody');
  tbody.innerHTML = '';
  for(const e of employees){
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${e.name}</td>
      <td>${fmt(e.base)}</td>
      <td>${fmt(e.bonus)}</td>
      <td>${fmt(e.deductions)}</td>
      <td>${fmt(calculateNet(e))}</td>
      <td style="text-align:right">
        <button class="btn ghost" onclick="editEmp('${e.id}')">Edit</button>
        <button class="btn danger" onclick="deleteEmp('${e.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  }
}

function renderKPIs(){
  const total = employees.reduce((a,b)=>a+calculateNet(b),0);
  const avg = employees.length? total/employees.length:0;
  const high = employees.length? Math.max(...employees.map(e=>calculateNet(e))):0;
  document.getElementById('totalPayroll').innerText = fmt(total);
  document.getElementById('avgSalary').innerText = fmt(avg);
  document.getElementById('highestSalary').innerText = fmt(high);
}

document.getElementById('addEmp').addEventListener('click',()=>{
  const name = document.getElementById('empName').value.trim();
  const base = Number(document.getElementById('baseSalary').value);
  const bonus = Number(document.getElementById('bonus').value);
  const deductions = Number(document.getElementById('deductions').value);
  if(!name || isNaN(base)) { alert('Enter name and base salary'); return; }
  employees.unshift({id:uid(),name,base,bonus,deductions});
  saveAll();
  document.getElementById('empName').value='';
  document.getElementById('baseSalary').value='';
  document.getElementById('bonus').value='';
  document.getElementById('deductions').value='';
});

function deleteEmp(id){ employees = employees.filter(e=>e.id!==id); saveAll(); }

function editEmp(id){
  const e = employees.find(x=>x.id===id); if(!e) return;
  const name = prompt('Employee Name', e.name); if(name===null) return;
  const base = prompt('Base Salary', e.base); if(base===null) return;
  const bonus = prompt('Bonus', e.bonus); if(bonus===null) return;
  const deductions = prompt('Deductions', e.deductions); if(deductions===null) return;
  e.name=name; e.base=Number(base)||0; e.bonus=Number(bonus)||0; e.deductions=Number(deductions)||0;
  saveAll();
}

document.getElementById('clearEmp').addEventListener('click',()=>{
  document.getElementById('empName').value='';
  document.getElementById('baseSalary').value='';
  document.getElementById('bonus').value='';
  document.getElementById('deductions').value='';
});

document.getElementById('exportCsv').addEventListener('click',()=>{
  let csv = 'Name,Base Salary,Bonus,Deductions,Net Salary\n';
  employees.forEach(e=>csv+=`${e.name},${e.base},${e.bonus},${e.deductions},${calculateNet(e)}\n`);
  const blob = new Blob([csv],{type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='payroll.csv'; a.click();
});

document.getElementById('exportJson').addEventListener('click',()=>{
  const blob = new Blob([JSON.stringify(employees,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='payroll.json'; a.click();
});

document.getElementById('importBtn').addEventListener('click',()=>document.getElementById('importFile').click());
document.getElementById('importFile').addEventListener('change',(e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => { try{ employees=JSON.parse(reader.result); saveAll(); }catch(err){ alert('Invalid JSON'); } }
  reader.readAsText(file);
});

document.getElementById('applyFilter').addEventListener('click',()=>{
  const search = document.getElementById('searchEmp').value.trim().toLowerCase();
  const tbody = document.getElementById('empTableBody');
  tbody.querySelectorAll('tr').forEach(tr=>{
    const name = tr.children[0].innerText.toLowerCase();
    tr.style.display = name.includes(search)? '': 'none';
  });
});

function goToDashboard(){ window.location.href='index.html'; }

loadAll();
</script>
</body>
</html>
