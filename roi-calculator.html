<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional ROI Calculator</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, select { padding: 8px; margin: 5px 0; width: 200px; }
button { padding: 8px 16px; margin: 10px 5px 0 0; cursor: pointer; }
.results { margin-top: 20px; }
.circle-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    margin-top: 10px;
}
.roi-ring { transform: rotate(-90deg); }
.circle-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 20px;
    font-weight: bold;
}
</style>
</head>
<body>

<h1>Professional ROI Calculator</h1>

<div>
    <label>Amount Invested:</label>
    <input type="number" id="amountInvested" placeholder="500">
    <select id="currencyInvested"></select>
</div>

<div>
    <label>Amount Returned:</label>
    <input type="number" id="amountReturned" placeholder="700">
    <select id="currencyReturned"></select>
</div>

<div>
    <label>Start Date:</label>
    <input type="date" id="startDate">
</div>

<div>
    <label>End Date:</label>
    <input type="date" id="endDate">
</div>

<div>
    <button onclick="calculateROI()">Calculate</button>
    <button onclick="clearFields()">Clear</button>
    <button onclick="downloadResults()">Download Results</button>
</div>

<div class="results">
    <div>Investment Gain: <span id="investmentGain">0</span></div>
    <div>ROI: <span id="roiPercent">0%</span></div>
    <div>Annualized ROI: <span id="annualizedROI">0%</span></div>
    <div>Investment Length (days): <span id="investmentLength">0</span></div>

    <div class="circle-wrapper">
        <svg class="roi-ring" width="120" height="120">
            <circle class="bg" cx="60" cy="60" r="50" stroke="#eee" stroke-width="10" fill="none" />
            <circle class="progress" cx="60" cy="60" r="50" stroke="green" stroke-width="10" fill="none"
                    stroke-linecap="round" stroke-dasharray="314" stroke-dashoffset="314" />
        </svg>
        <div class="circle-text" id="roiCircle">0%</div>
    </div>
</div>

<script src="loadCurrencies.js"></script>
<script>
populateCurrencyDropdown('currencyInvested');
populateCurrencyDropdown('currencyReturned');

async function calculateROI() {
    let invested = parseFloat(document.getElementById('amountInvested').value);
    let returned = parseFloat(document.getElementById('amountReturned').value);
    const start = new Date(document.getElementById('startDate').value);
    const end = new Date(document.getElementById('endDate').value);

    const fromCurrency = document.getElementById('currencyInvested').value;
    const toCurrency = document.getElementById('currencyReturned').value;

    if (isNaN(invested) || isNaN(returned) || !start || !end || !fromCurrency || !toCurrency) {
        alert("Please fill all fields correctly.");
        return;
    }

    // Real-time currency conversion if needed
    if(fromCurrency !== toCurrency) {
        const apiUrl = `https://api.exchangerate.host/convert?from=${toCurrency}&to=${fromCurrency}&amount=${returned}`;
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            returned = data.result;
        } catch(err) {
            alert("Currency conversion failed. Using original amounts.");
        }
    }

    const gain = returned - invested;
    const roi = (gain / invested) * 100;
    const days = (end - start) / (1000 * 60 * 60 * 24);
    const annualized = ((returned / invested) ** (365 / days) - 1) * 100;

    document.getElementById('investmentGain').innerText = gain.toFixed(2);
    document.getElementById('roiPercent').innerText = roi.toFixed(2) + "%";
    document.getElementById('annualizedROI').innerText = annualized.toFixed(2) + "%";
    document.getElementById('investmentLength').innerText = days.toFixed(0);

    // Update circular progress ring
    const progressCircle = document.querySelector('.progress');
    const roiValue = Math.min(Math.abs(roi), 100); // cap at 100%
    const circumference = 2 * Math.PI * 50;
    const offset = circumference - (roiValue / 100) * circumference;
    progressCircle.style.strokeDashoffset = offset;
    progressCircle.style.stroke = roi >= 0 ? "green" : "red";

    document.getElementById('roiCircle').innerText = roi.toFixed(2) + "%";
}

function clearFields() {
    document.getElementById('amountInvested').value = '';
    document.getElementById('amountReturned').value = '';
    document.getElementById('startDate').value = '';
    document.getElementById('endDate').value = '';
    document.getElementById('investmentGain').innerText = '0';
    document.getElementById('roiPercent').innerText = '0%';
    document.getElementById('annualizedROI').innerText = '0%';
    document.getElementById('investmentLength').innerText = '0';
    const progressCircle = document.querySelector('.progress');
    progressCircle.style.strokeDashoffset = 314;
    progressCircle.style.stroke = "green";
    document.getElementById('roiCircle').innerText = '0%';
}

function downloadResults() {
    const invested = document.getElementById('amountInvested').value;
    const returned = document.getElementById('amountReturned').value;
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    const gain = document.getElementById('investmentGain').innerText;
    const roi = document.getElementById('roiPercent').innerText;
    const annualized = document.getElementById('annualizedROI').innerText;
    const days = document.getElementById('investmentLength').innerText;
    const currencyInvested = document.getElementById('currencyInvested').value;
    const currencyReturned = document.getElementById('currencyReturned').value;

    const csvContent = `Investment Amount,${invested},${currencyInvested}\nReturned Amount,${returned},${currencyReturned}\nStart Date,${start}\nEnd Date,${end}\nInvestment Gain,${gain}\nROI,${roi}\nAnnualized ROI,${annualized}\nInvestment Length (days),${days}`;
    
    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ROI_Calculator_Results.csv';
    a.click();
    URL.revokeObjectURL(url);
}
</script>
</body>
</html>
