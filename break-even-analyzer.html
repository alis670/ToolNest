<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Break-Even Analyzer</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
input, select { padding: 8px; margin: 5px 0; width: 200px; }
button { padding: 8px 16px; margin: 10px 5px 0 0; cursor: pointer; }
.results { margin-top: 20px; }
.circle-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    margin-top: 10px;
    display: inline-block;
    margin-right: 20px;
}
.roi-ring { transform: rotate(-90deg); }
.circle-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 18px;
    font-weight: bold;
    text-align: center;
}
</style>
</head>
<body>

<h1>Break-Even Analyzer</h1>

<div>
    <label>Fixed Costs:</label>
    <input type="number" id="fixedCosts" placeholder="1000">
    <select id="currencyFixed"></select>
</div>

<div>
    <label>Variable Cost per Unit:</label>
    <input type="number" id="variableCost" placeholder="50">
</div>

<div>
    <label>Selling Price per Unit:</label>
    <input type="number" id="sellingPrice" placeholder="100">
</div>

<div>
    <label>Units Sold (optional):</label>
    <input type="number" id="unitsSold" placeholder="50">
</div>

<div>
    <button onclick="calculateBreakEven()">Calculate</button>
    <button onclick="clearFields()">Clear</button>
    <button onclick="downloadResults()">Download Results</button>
</div>

<div class="results">
    <div>Break-Even Units: <span id="breakEvenUnits">0</span></div>
    <div>Break-Even Revenue: <span id="breakEvenRevenue">0</span></div>
    <div>Profit: <span id="profit">0</span></div>
    <div>Profit Margin: <span id="profitMargin">0%</span></div>

    <div class="circle-wrapper">
        <svg class="roi-ring" width="120" height="120">
            <circle class="bg" cx="60" cy="60" r="50" stroke="#eee" stroke-width="10" fill="none" />
            <circle class="progressProfit" cx="60" cy="60" r="50" stroke="green" stroke-width="10" fill="none"
                    stroke-linecap="round" stroke-dasharray="314" stroke-dashoffset="314" />
        </svg>
        <div class="circle-text" id="profitCircle">0%</div>
        <div style="text-align:center;">Profit Margin</div>
    </div>
</div>

<!-- Back to Dashboard button -->
<div style="margin-top:20px;">
    <button onclick="goToDashboard()" style="padding:8px 16px; cursor:pointer;">â¬… Back to Dashboard</button>
</div>

<script src="loadCurrencies.js"></script>
<script>
populateCurrencyDropdown('currencyFixed');

function calculateBreakEven() {
    let fixed = parseFloat(document.getElementById('fixedCosts').value);
    let variable = parseFloat(document.getElementById('variableCost').value);
    let price = parseFloat(document.getElementById('sellingPrice').value);
    let unitsSold = parseFloat(document.getElementById('unitsSold').value) || 0;

    if(isNaN(fixed) || isNaN(variable) || isNaN(price) || price <= variable) {
        alert("Please enter valid numbers. Selling Price must be greater than Variable Cost.");
        return;
    }

    let breakEvenUnits = fixed / (price - variable);
    let breakEvenRevenue = breakEvenUnits * price;
    let profit = (unitsSold * (price - variable)) - fixed;
    let profitMargin = unitsSold > 0 ? (profit / (unitsSold * price)) * 100 : 0;

    document.getElementById('breakEvenUnits').innerText = breakEvenUnits.toFixed(2);
    document.getElementById('breakEvenRevenue').innerText = breakEvenRevenue.toFixed(2);
    document.getElementById('profit').innerText = profit.toFixed(2);
    document.getElementById('profitMargin').innerText = profitMargin.toFixed(2) + "%";

    // Update Profit Margin Circle
    const profitCircle = document.querySelector('.progressProfit');
    const offset = 314 - (Math.min(Math.abs(profitMargin),100)/100)*314;
    profitCircle.style.strokeDashoffset = offset;
    profitCircle.style.stroke = profitMargin >= 0 ? "green" : "red";
    document.getElementById('profitCircle').innerText = profitMargin.toFixed(2) + "%";
}

function clearFields() {
    document.getElementById('fixedCosts').value = '';
    document.getElementById('variableCost').value = '';
    document.getElementById('sellingPrice').value = '';
    document.getElementById('unitsSold').value = '';
    document.getElementById('breakEvenUnits').innerText = '0';
    document.getElementById('breakEvenRevenue').innerText = '0';
    document.getElementById('profit').innerText = '0';
    document.getElementById('profitMargin').innerText = '0%';
    document.querySelector('.progressProfit').style.strokeDashoffset = 314;
    document.querySelector('.progressProfit').style.stroke = 'green';
    document.getElementById('profitCircle').innerText = '0%';
}

function downloadResults() {
    const fixed = document.getElementById('fixedCosts').value;
    const variable = document.getElementById('variableCost').value;
    const price = document.getElementById('sellingPrice').value;
    const unitsSold = document.getElementById('unitsSold').value;
    const breakEvenUnits = document.getElementById('breakEvenUnits').innerText;
    const breakEvenRevenue = document.getElementById('breakEvenRevenue').innerText;
    const profit = document.getElementById('profit').innerText;
    const profitMargin = document.getElementById('profitMargin').innerText;
    const currency = document.getElementById('currencyFixed').value;

    const csvContent = `Fixed Costs,${fixed},${currency}\nVariable Cost per Unit,${variable}\nSelling Price per Unit,${price}\nUnits Sold,${unitsSold}\nBreak-Even Units,${breakEvenUnits}\nBreak-Even Revenue,${breakEvenRevenue}\nProfit,${profit}\nProfit Margin,${profitMargin}`;

    const blob = new Blob([csvContent], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'BreakEven_Results.csv';
    a.click();
    URL.revokeObjectURL(url);
}

function goToDashboard() {
    window.location.href = "index.html";
}
</script>
</body>
</html>
