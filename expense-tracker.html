<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Advanced Expense Tracker</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-gray-100 text-gray-900">

<div class="max-w-5xl mx-auto p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">ðŸ’° Advanced Expense Tracker</h1>

  <!-- Input Form -->
  <div class="bg-white shadow-md rounded-lg p-5 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <input id="date" type="date" class="border p-2 rounded" />
      <input id="category" type="text" placeholder="Category (e.g. Food)" class="border p-2 rounded" />
      <input id="amount" type="number" placeholder="Amount" class="border p-2 rounded" />
      <input id="note" type="text" placeholder="Note (optional)" class="border p-2 rounded" />
    </div>
    <button onclick="addExpense()" class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Add Expense</button>
  </div>

  <!-- Summary -->
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold">Expense Summary</h2>
    <div>
      <button onclick="exportExcel()" class="bg-blue-600 text-white px-3 py-2 rounded mr-2 hover:bg-blue-700">ðŸ“˜ Export Excel</button>
      <button onclick="exportPDF()" class="bg-red-600 text-white px-3 py-2 rounded mr-2 hover:bg-red-700">ðŸ“„ Export PDF</button>
      <button onclick="resetTracker()" class="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700">â™» Reset</button>
    </div>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto bg-white rounded-lg shadow-md">
    <table id="expenseTable" class="min-w-full text-left border-collapse">
      <thead class="bg-gray-200">
        <tr>
          <th class="p-3 border">Date</th>
          <th class="p-3 border">Category</th>
          <th class="p-3 border">Amount</th>
          <th class="p-3 border">Note</th>
          <th class="p-3 border">Action</th>
        </tr>
      </thead>
      <tbody id="expenseBody"></tbody>
    </table>
  </div>

  <!-- Total -->
  <div class="mt-6 text-right text-xl font-semibold">
    Total: $<span id="totalAmount">0</span>
  </div>

  <!-- Chart -->
  <div class="mt-8 bg-white p-5 rounded-lg shadow-md">
    <canvas id="expenseChart"></canvas>
  </div>
</div>

<script>
let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
let chart;

function renderTable() {
  const tbody = document.getElementById('expenseBody');
  tbody.innerHTML = '';
  let total = 0;

  expenses.forEach((e, i) => {
    total += e.amount;
    tbody.innerHTML += `
      <tr class="border-b">
        <td class="p-3 border">${e.date}</td>
        <td class="p-3 border">${e.category}</td>
        <td class="p-3 border">$${e.amount.toFixed(2)}</td>
        <td class="p-3 border">${e.note || ''}</td>
        <td class="p-3 border text-center">
          <button onclick="deleteExpense(${i})" class="text-red-600 hover:underline">Delete</button>
        </td>
      </tr>`;
  });

  document.getElementById('totalAmount').textContent = total.toFixed(2);
  updateChart();
  localStorage.setItem('expenses', JSON.stringify(expenses));
}

function addExpense() {
  const date = document.getElementById('date').value;
  const category = document.getElementById('category').value;
  const amount = parseFloat(document.getElementById('amount').value);
  const note = document.getElementById('note').value;

  if (!date || !category || isNaN(amount)) return alert('Please enter valid details.');

  expenses.push({ date, category, amount, note });
  renderTable();

  document.getElementById('date').value = '';
  document.getElementById('category').value = '';
  document.getElementById('amount').value = '';
  document.getElementById('note').value = '';
}

function deleteExpense(i) {
  expenses.splice(i, 1);
  renderTable();
}

function resetTracker() {
  if (confirm("Are you sure you want to reset all data?")) {
    expenses = [];
    renderTable();
  }
}

function updateChart() {
  const categoryTotals = {};
  expenses.forEach(e => categoryTotals[e.category] = (categoryTotals[e.category] || 0) + e.amount);
  const ctx = document.getElementById('expenseChart').getContext('2d');

  if (chart) chart.destroy();
  chart = new Chart(ctx, {
    type: 'pie',
    data: {
      labels: Object.keys(categoryTotals),
      datasets: [{
        data: Object.values(categoryTotals),
        backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#E91E63', '#9C27B0', '#795548']
      }]
    }
  });
}

// Export Excel
function exportExcel() {
  const wb = XLSX.utils.book_new();
  const ws = XLSX.utils.json_to_sheet(expenses);
  XLSX.utils.book_append_sheet(wb, ws, "Expenses");
  XLSX.writeFile(wb, "ExpenseTracker.xlsx");
}

// Export PDF
async function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Expense Tracker Report", 14, 10);
  let y = 20;
  expenses.forEach((e, i) => {
    doc.text(`${i + 1}. ${e.date} | ${e.category} | $${e.amount} | ${e.note}`, 14, y);
    y += 8;
  });
  doc.text(`\nTotal: $${expenses.reduce((a, b) => a + b.amount, 0).toFixed(2)}`, 14, y + 5);
  doc.save("ExpenseReport.pdf");
}

renderTable();
</script>

</body>
</html>
