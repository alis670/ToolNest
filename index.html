<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MarketNest</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@keyframes fadeIn {0%{opacity:0}100%{opacity:1}}
.animate-fadeIn {animation:fadeIn 0.5s ease-in;}
</style>
</head>
<body class="bg-gray-100">

<!-- Navbar -->
<nav class="bg-white shadow-md p-4 flex justify-between items-center fixed w-full z-50 top-0">
  <div class="flex items-center space-x-2">
    <img src="https://img.icons8.com/ios-filled/40/000000/market.png" alt="Logo" class="w-10 h-10">
    <h1 class="text-2xl font-bold text-blue-600">MarketNest</h1>
  </div>
  <div>
    <button id="loginBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg">Login</button>
    <button id="logoutBtn" class="hidden px-4 py-2 bg-red-500 text-white rounded-lg">Logout</button>
  </div>
</nav>

<!-- Spacer -->
<div class="h-20"></div>

<!-- Dashboard container (hidden initially) -->
<main id="dashboardContainer" class="max-w-7xl mx-auto p-6 space-y-12 hidden">
  <h2 class="text-xl text-gray-600">Welcome! Your tools will appear after login.</h2>
</main>

<!-- Auth Modal -->
<div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
  <div class="bg-white rounded-xl w-96 p-6 shadow-lg relative animate-fadeIn">
    <button id="closeModal" class="absolute top-2 right-2 text-gray-500 text-xl">&times;</button>
    <div class="text-center mb-4 flex items-center justify-center space-x-2">
      <img src="https://img.icons8.com/ios-filled/40/000000/market.png"/>
      <h2 id="modalTitle" class="text-2xl font-bold">Login</h2>
    </div>
    <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded mb-3" />
    <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded mb-4" />
    <button id="submitAuth" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold">Continue</button>
    <p id="toggleAuth" class="text-center text-sm text-blue-500 mt-3 cursor-pointer">Create an account</p>
    <p id="forgotPass" class="text-center text-sm text-gray-500 mt-1 cursor-pointer">Forgot Password?</p>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-5 right-5 z-50"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  signOut, 
  sendPasswordResetEmail,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBuYXfr-_q-BJskWHN4chB8SZqMc-P9odw",
  authDomain: "toolnest-8e42d.firebaseapp.com",
  projectId: "toolnest-8e42d",
  storageBucket: "toolnest-8e42d.firebasestorage.app",
  messagingSenderId: "988256036107",
  appId: "1:988256036107:web:90f7e40f07593dff8e2e0e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// UI Elements
const authModal = document.getElementById('authModal');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const closeModal = document.getElementById('closeModal');
const modalTitle = document.getElementById('modalTitle');
const submitAuth = document.getElementById('submitAuth');
const toggleAuth = document.getElementById('toggleAuth');
const forgotPass = document.getElementById('forgotPass');
const emailInput = document.getElementById('email');
const passInput = document.getElementById('password');
const dashboardContainer = document.getElementById('dashboardContainer');
const toastContainer = document.getElementById('toastContainer');

let isSignup = false;

// ---------------- Toast function ----------------
function showToast(message, type="success"){
  const toast = document.createElement('div');
  toast.innerText = message;
  toast.className = `px-4 py-2 mb-2 rounded shadow-lg text-white ${type==="success"?"bg-green-500":"bg-red-500"} animate-fadeIn`;
  toastContainer.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

// ---------------- Modal Logic ----------------
function openModal(signup){
  isSignup = signup;
  modalTitle.innerText = signup?"Create Account":"Login";
  submitAuth.innerText = signup?"Sign Up":"Login";
  toggleAuth.innerText = signup?"Already have an account?":"Create an account";
  authModal.classList.remove('hidden');
}

loginBtn.onclick = ()=>openModal(false);
closeModal.onclick = ()=>authModal.classList.add('hidden');
toggleAuth.onclick = ()=>openModal(!isSignup);

// ---------------- Auth Actions ----------------
submitAuth.onclick = async ()=>{
  const email = emailInput.value;
  const pass = passInput.value;
  if(!email||!pass){showToast("Please fill all fields","error"); return;}
  try{
    if(isSignup){
      await createUserWithEmailAndPassword(auth,email,pass);
      showToast("Account created successfully!");
    }else{
      await signInWithEmailAndPassword(auth,email,pass);
      showToast("Login successful!");
    }
    authModal.classList.add('hidden');
  }catch(e){showToast(e.message,"error")}
}

logoutBtn.onclick = async ()=>{
  await signOut(auth);
  showToast("Logged out successfully!");
}

// Forgot password
forgotPass.onclick = async ()=>{
  const email = emailInput.value;
  if(!email){showToast("Enter your email first","error"); return;}
  try{
    await sendPasswordResetEmail(auth,email);
    showToast("Password reset email sent successfully!");
  }catch(e){showToast(e.message,"error")}
}

// ---------------- Update UI ----------------
onAuthStateChanged(auth,user=>{
  if(user){
    loginBtn.classList.add('hidden');
    logoutBtn.classList.remove('hidden');
    dashboardContainer.classList.remove('hidden');
  }else{
    loginBtn.classList.remove('hidden');
    logoutBtn.classList.add('hidden');
    dashboardContainer.classList.add('hidden');
  }
});
</script>
</body>
</html>
