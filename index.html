<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ToolNest Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@keyframes fadeIn {0%{opacity:0}100%{opacity:1}}
.animate-fadeIn {animation:fadeIn 0.5s ease-in;}
.backdrop-blur {backdrop-filter: blur(10px);}
</style>
</head>
<body class="bg-gray-100 min-h-screen">

<!-- Auth Modal -->
<div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
  <div class="bg-white/10 backdrop-blur rounded-xl w-96 p-6 shadow-lg relative animate-fadeIn border border-white/20">

    <!-- ToolNest Logo -->
    <div class="text-center mb-4 flex flex-col items-center">
      <div class="w-20 h-20 rounded-full bg-gradient-to-r from-blue-400 to-purple-600 flex items-center justify-center shadow-lg">
        <span class="text-white text-2xl font-bold">ToolNest</span>
      </div>
    </div>

    <!-- Modal Title -->
    <h2 id="modalTitle" class="text-xl font-semibold text-center mb-4 text-white">ToolNest</h2>

    <!-- Email / Password Input -->
    <input type="email" id="email" placeholder="Email" class="w-full p-2 border rounded mb-3 bg-white/30 text-white placeholder-white" />
    <input type="password" id="password" placeholder="Password" class="w-full p-2 border rounded mb-3 bg-white/30 text-white placeholder-white" />

    <!-- Phone Input -->
    <input type="text" id="phoneNumber" placeholder="+CountryCode PhoneNumber" class="w-full p-2 border rounded mb-3 bg-white/30 text-white placeholder-white" />

    <!-- OTP Input (hidden initially) -->
    <input type="text" id="otpCode" placeholder="Enter OTP" class="w-full p-2 border rounded mb-3 bg-white/30 text-white placeholder-white hidden" />

    <!-- Continue Button (handles email & phone) -->
    <button id="continueBtn" class="w-full bg-blue-600 text-white py-2 rounded-lg font-semibold mb-3">Continue</button>

    <!-- Create Account / Toggle -->
    <p id="toggleAuth" class="text-center text-sm text-blue-400 mt-2 cursor-pointer">Create an account</p>
    <p id="forgotPass" class="text-center text-sm text-gray-300 mt-1 cursor-pointer">Forgot Password?</p>

    <!-- Google Login -->
    <button id="googleSignIn" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold mt-4">Continue with Google</button>
    
  </div>
</div>

<!-- Dashboard -->
<main id="dashboardContainer" class="max-w-7xl mx-auto p-6 space-y-12 hidden">
  <h1 class="text-3xl font-bold text-gray-700 mb-6">ToolNest Dashboard</h1>
  <div id="categoriesContainer" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</main>

<!-- Toast Container -->
<div id="toastContainer" class="fixed top-5 right-5 z-50"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword, 
  signInWithEmailAndPassword, 
  signOut, 
  sendPasswordResetEmail,
  onAuthStateChanged,
  GoogleAuthProvider,
  signInWithPopup,
  RecaptchaVerifier,
  signInWithPhoneNumber
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBuYXfr-_q-BJskWHN4chB8SZqMc-P9odw",
  authDomain: "toolnest-8e42d.firebaseapp.com",
  projectId: "toolnest-8e42d",
  storageBucket: "toolnest-8e42d.firebasestorage.app",
  messagingSenderId: "988256036107",
  appId: "1:988256036107:web:90f7e40f07593dff8e2e0e"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// UI Elements
const authModal = document.getElementById('authModal');
const modalTitle = document.getElementById('modalTitle');
const continueBtn = document.getElementById('continueBtn');
const toggleAuth = document.getElementById('toggleAuth');
const forgotPass = document.getElementById('forgotPass');
const emailInput = document.getElementById('email');
const passInput = document.getElementById('password');
const phoneInput = document.getElementById('phoneNumber');
const otpInput = document.getElementById('otpCode');
const googleSignIn = document.getElementById('googleSignIn');
const dashboardContainer = document.getElementById('dashboardContainer');
const categoriesContainer = document.getElementById('categoriesContainer');
const toastContainer = document.getElementById('toastContainer');

let isSignup = false;

// Toast function
function showToast(message, type="success"){
  const toast = document.createElement('div');
  toast.innerText = message;
  toast.className = `px-4 py-2 mb-2 rounded shadow-lg text-white ${type==="success"?"bg-green-500":"bg-red-500"} animate-fadeIn`;
  toastContainer.appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

// Toggle modal
function openModal(signup){
  isSignup = signup;
  modalTitle.innerText = "ToolNest";
  continueBtn.innerText = signup?"Sign Up":"Continue";
  toggleAuth.innerText = signup?"Already have an account?":"Create an account";
  authModal.classList.remove('hidden');
}
toggleAuth.onclick = ()=>openModal(!isSignup);

// Google login
googleSignIn.onclick = async ()=>{
  try{
    await signInWithPopup(auth,provider);
    showToast("Google login successful!");
    authModal.classList.add('hidden');
  }catch(e){showToast(e.message,"error")}
}

// Recaptcha for phone
window.recaptchaVerifier = new RecaptchaVerifier('continueBtn', {
  'size': 'invisible',
  'callback': (response) => { console.log('Recaptcha verified'); }
}, auth);

// Continue button handles email/password or phone
continueBtn.onclick = async ()=>{
  const email = emailInput.value.trim();
  const password = passInput.value.trim();
  const phone = phoneInput.value.trim();
  const otp = otpInput.value.trim();

  // PHONE OTP Verification
  if(phone && otpInput.classList.contains('block')){
    if(!otp){ showToast("Enter OTP","error"); return; }
    window.confirmationResult.confirm(otp)
      .then(()=>{ showToast("Phone login successful!"); authModal.classList.add('hidden'); })
      .catch(e=>showToast(e.message,"error"));
    return;
  }

  // PHONE LOGIN (send OTP)
  if(phone && !otpInput.classList.contains('block')){
    if(!phone){ showToast("Enter phone number","error"); return; }
    const appVerifier = window.recaptchaVerifier;
    signInWithPhoneNumber(auth, phone, appVerifier)
      .then((confirmationResult)=>{
        window.confirmationResult = confirmationResult;
        otpInput.classList.remove('hidden');
        otpInput.classList.add('block');
        showToast("OTP sent to your phone");
      })
      .catch(e=>showToast(e.message,"error"));
    return;
  }

  // EMAIL LOGIN / SIGNUP
  if(email && password){
    try{
      if(isSignup){
        await createUserWithEmailAndPassword(auth,email,password);
        showToast("Account created successfully!");
      }else{
        await signInWithEmailAndPassword(auth,email,password);
        showToast("Login successful!");
      }
      authModal.classList.add('hidden');
    }catch(e){showToast(e.message,"error")}
    return;
  }

  showToast("Enter email/password or phone number","error");
}

// Forgot password
forgotPass.onclick = async ()=>{
  const email = emailInput.value.trim();
  if(!email){showToast("Enter your email first","error"); return;}
  try{
    await sendPasswordResetEmail(auth,email);
    showToast("Password reset email sent!");
  }catch(e){showToast(e.message,"error")}
}

// Logout button
const logoutBtn = document.createElement('button');
logoutBtn.className="fixed bottom-5 right-5 px-4 py-2 bg-red-500 text-white rounded-lg hidden";
logoutBtn.innerText="Logout";
document.body.appendChild(logoutBtn);
logoutBtn.onclick = async ()=>{
  await signOut(auth);
  showToast("Logged out successfully!");
}

// Tool & Category Data (unchanged)
const categories = [
  { name: "Finance & Accounting", icon: "ðŸ’°", tools: ["ROI Calculator","Profit Margin Calculator","Break-even Analyzer","Loan EMI Calculator","Tax / GST / VAT Calculator","Currency Converter","Expense Tracker","Cash Flow Analyzer","Salary / Payroll Sheet"] },
  { name: "Business Management", icon: "ðŸ“Š", tools: ["Revenue Forecast Tool","Budget Planner","Employee Attendance Tracker","Invoice Generator","Business Proposal Template","Time Tracking Tool","Meeting Notes Template"] },
  { name: "E-commerce & Marketing", icon: "ðŸ›’", tools: ["Product Pricing Calculator","Discount Finder","Inventory Tracker","Keyword Research Tool","Competitor Tracker","Profit & Fee Calculator","Product Launch Planner"] },
  { name: "Data & Productivity", icon: "ðŸ“ˆ", tools: ["Google Sheets Templates","Excel Business Templates","CSV â†’ Excel Converter","Sheet Merger Tool","Data Cleaner","Dashboard Template"] },
  { name: "AI & Automation", icon: "ðŸ¤–", tools: ["ChatGPT Assistant","Gemini UI","Auto Email Generator","Task Automation Templates","AI Name/Slogan Generator","Document Summarizer"] },
  { name: "Design & Branding", icon: "ðŸŽ¨", tools: ["Logo Maker","Business Card Template","Brand Color Palette Generator","Social Media Post Caption Generator"] },
  { name: "Website & SEO", icon: "ðŸŒ", tools: ["Meta Tag Generator","SEO Keyword Density Checker","Backlink Tracker","Sitemap XML Generator","Page Speed Tester"] },
  { name: "Communication & Management", icon: "ðŸ’¬", tools: ["Project Task Manager","Team Chat UI","Client Feedback Form","Email Signature Generator"] },
  { name: "Premium Tools", icon: "ðŸš€", tools: ["MarketNest Pro Analyzer","Business Intelligence Dashboard","AI Data Visualizer","Multi-user Team Workspace"] }
];

// Render Dashboard
function renderDashboard(){
  categoriesContainer.innerHTML = "";
  categories.forEach(cat=>{
    const catDiv = document.createElement('div');
    catDiv.className="bg-white rounded-xl shadow p-4 hover:shadow-lg";
    const catHeader = document.createElement('div');
    catHeader.className="flex items-center mb-3";
    const iconSpan = document.createElement('span');
    iconSpan.className="text-3xl mr-3";
    iconSpan.innerText = cat.icon;
    const nameSpan = document.createElement('span');
    nameSpan.className="font-semibold text-lg";
    nameSpan.innerText = cat.name;
    catHeader.append(iconSpan,nameSpan);
    catDiv.appendChild(catHeader);
    const toolsList = document.createElement('ul');
    toolsList.className="list-disc list-inside text-gray-600 space-y-1";
    cat.tools.forEach(tool=>{
      const li = document.createElement('li');
      li.innerText = tool;
      toolsList.appendChild(li);
    });
    catDiv.appendChild(toolsList);
    categoriesContainer.appendChild(catDiv);
  });
}

// Auth state changes
onAuthStateChanged(auth,user=>{
  if(user){
    dashboardContainer.classList.remove('hidden');
    authModal.classList.add('hidden');
    logoutBtn.classList.remove('hidden');
    renderDashboard();
  }else{
    dashboardContainer.classList.add('hidden');
    logoutBtn.classList.add('hidden');
    authModal.classList.remove('hidden');
    openModal(false);
  }
});

// Tool click navigation
document.addEventListener("click", (e) => {
  if (e.target.tagName === "LI") {
    const toolName = e.target.innerText.trim();
    if (toolName === "ROI Calculator") { window.open("roi-calculator.html", "_blank"); } 
    else if (toolName === "Profit Margin Calculator") { window.open("profit-margin-calculator.html", "_blank"); } 
    else if (toolName === "Break-even Analyzer") { window.open("break-even-analyzer.html", "_blank"); } 
    else if (toolName === "Loan EMI Calculator") { window.open("loan-emi-calculator.html", "_blank"); }
  }
});
</script>
</body>
</html>
